from fastapi.middleware.cors import CORSMiddleware
from fastapi import FastAPI, Request
from .routers import console, event, rule, scope, profile, segment, auth
from fastapi.responses import Response

application = FastAPI(

)
application.include_router(console.router)
application.include_router(event.router)
application.include_router(rule.router)
application.include_router(scope.router)
application.include_router(profile.router)
application.include_router(segment.router)
application.include_router(auth.router)

application.add_middleware(
    CORSMiddleware,
    allow_origins=['*'],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

class JavascriptResponse(Response):
    media_type = "appliaction/javascript"


# """
# Authentication
# """
#
#
@application.post("/heathcheck")
async def login(request: Request):
    q = await request.body()
    q = q.decode('utf-8')
    print(q)
    return q


@application.get("/heathcheck")
async def login(request: Request):
    q = await request.body()
    q = q.decode('utf-8')
    print(q)
    return q


@application.get("/tracker/unomi-tracker.min.js", response_class=JavascriptResponse)
async def login():
    return """
/*!
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * @license Apache-2.0
 */
!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).unomiTracker=t()}(function(){return function r(o,i,a){function s(e,t){if(!i[e]){if(!o[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(c)return c(e,!0);throw(n=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",n}n=i[e]={exports:{}},o[e][0].call(n.exports,function(t){return s(o[e][1][t]||t)},n,n.exports,r,o,i,a)}return i[e].exports}for(var c="function"==typeof require&&require,t=0;t<a.length;t++)s(a[t]);return s}({1:[function(t,e,n){"use strict";var i=t("@ndhoule/arity"),a=Object.prototype.toString;e.exports=function(t,e){if("number"!=(r=typeof(n=t))&&("object"!=r||"[object Number]"!==a.call(n)))throw new TypeError("Expected a number but received "+typeof t);var n,r;if("function"!=typeof e)throw new TypeError("Expected a function but received "+typeof e);var o=0;return i(e.length,function(){if(!((o+=1)<t))return e.apply(this,arguments)})}},{"@ndhoule/arity":2}],2:[function(t,e,n){"use strict";var o=Object.prototype.toString,i=[function(t){return function(){return t.apply(this,arguments)}},function(e){return function(t){return e.apply(this,arguments)}},function(n){return function(t,e){return n.apply(this,arguments)}},function(r){return function(t,e,n){return r.apply(this,arguments)}},function(o){return function(t,e,n,r){return o.apply(this,arguments)}},function(i){return function(t,e,n,r,o){return i.apply(this,arguments)}}];e.exports=function(t,e){if("function"!=typeof e)throw new TypeError("Expected a function but got "+typeof e);var n,r;return t=Math.max("number"==(r=typeof(n=t))||"object"==r&&"[object Number]"===o.call(n)?t:0,0),i[t]||(i[t]=function(t){t=function(t){for(var e=[],n=1;n<=t;n+=1)e.push("arg"+n);return e}(t).join(", "),t="".concat("  return function(",t,") {\n","    return func.apply(this, arguments);\n","  };");return new Function("func",t)}(t)),i[t](e)}},{}],3:[function(t,e,n){"use strict";var s=t("component-type"),t=function t(e){var n=s(e);if("object"===n){var r,o={};for(r in e)e.hasOwnProperty(r)&&(o[r]=t(e[r]));return o}if("array"===n){for(var o=new Array(e.length),i=0,a=e.length;i<a;i++)o[i]=t(e[i]);return o}if("regexp"!==n)return"date"===n?new Date(e.getTime()):e;n="";return n+=e.multiline?"m":"",n+=e.global?"g":"",n+=e.ignoreCase?"i":"",new RegExp(e.source,n)};e.exports=t},{"component-type":57}],4:[function(t,e,n){"use strict";function o(t){return Boolean(t)&&"[object Object]"===u.call(t)}function a(t,e,n,r){return c.call(e,r)&&void 0===t[r]&&(t[r]=n),e}function r(t,e){if(n=e,!Boolean(n)||"object"!=typeof n)return e;var n;t=t||a;for(var r=s(2,arguments),o=0;o<r.length;o+=1)for(var i in r[o])t(e,r[o],r[o][i],i);return e}var s=t("@ndhoule/drop"),i=t("@ndhoule/rest"),c=Object.prototype.hasOwnProperty,u=Object.prototype.toString,l=function(t){return r.apply(null,[function(t,e,n,r){return c.call(e,r)&&(o(t[r])&&o(n)?t[r]=l(t[r],n):void 0===t[r]&&(t[r]=n)),e},t].concat(i(arguments)))};e.exports=function(t){return r.apply(null,[null,t].concat(i(arguments)))},e.exports.deep=l},{"@ndhoule/drop":5,"@ndhoule/rest":14}],5:[function(t,e,n){"use strict";var s=Math.max;e.exports=function(t,e){var n=e?e.length:0;if(!n)return[];for(var r=s(Number(t)||0,0),o=s(n-r,0),i=new Array(o),a=0;a<o;a+=1)i[a]=e[a+r];return i}},{}],6:[function(t,e,n){"use strict";function r(t){return null!=t&&(a(t)||"function"!==t&&(e=t.length,"number"==(t=typeof e)||"object"==t&&"[object Number]"===i.call(e)));var e}var o=t("@ndhoule/keys"),i=Object.prototype.toString,a="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===i.call(t)};e.exports=function(t,e){return(r(e)?function(t,e){for(var n=0;n<e.length&&!1!==t(e[n],n,e);n+=1);}:function(t,e){for(var n=o(e),r=0;r<n.length&&!1!==t(e[n[r]],n[r],e);r+=1);}).call(this,t,e)}},{"@ndhoule/keys":11}],7:[function(t,e,n){"use strict";var i=t("@ndhoule/each");e.exports=function(r,t){if("function"!=typeof r)throw new TypeError("`predicate` must be a function but was a "+typeof r);var o=!0;return i(function(t,e,n){if(!(o=!!r(t,e,n)))return!1},t),o}},{"@ndhoule/each":6}],8:[function(t,e,n){"use strict";var o=Object.prototype.hasOwnProperty;e.exports=function(t){for(var e=Array.prototype.slice.call(arguments,1),n=0;n<e.length;n+=1)for(var r in e[n])o.call(e[n],r)&&(t[r]=e[n][r]);return t}},{}],9:[function(t,e,n){"use strict";var i=t("@ndhoule/each");e.exports=function(r,o,t){if("function"!=typeof r)throw new TypeError("Expected a function but received a "+typeof r);return i(function(t,e,n){o=r(o,t,e,n)},t),o}},{"@ndhoule/each":6}],10:[function(t,e,n){"use strict";var o=t("@ndhoule/each"),i=String.prototype.indexOf;e.exports=function(n,t){var r=!1;return"string"==typeof t?-1!==i.call(t,n):(o(function(t){if((e=t)===(t=n)?0!==e||1/e==1/t:e!=e&&t!=t)return!(r=!0);var e},t),r)}},{"@ndhoule/each":6}],11:[function(t,e,n){"use strict";function r(t,e){return s.call(t,e)}function i(t,e){return a.call(t,e)}function o(t,e){e=e||i;for(var n=[],r=0,o=t.length;r<o;r+=1)e(t,r)&&n.push(String(r));return n}var a=Object.prototype.hasOwnProperty,s=String.prototype.charAt,c=Object.prototype.toString;e.exports=function(t){return null==t?[]:(e=t,"[object String]"===c.call(e)?o(t,r):null!=(e=t)&&"function"!=typeof e&&"number"==typeof e.length?o(t,i):function(t,e){e=e||i;var n,r=[];for(n in t)e(t,n)&&r.push(String(n));return r}(t));var e}},{}],12:[function(t,e,n){"use strict";var i=t("@ndhoule/each");e.exports=function(r,t){if("function"!=typeof r)throw new TypeError("Expected a function but received a "+typeof r);var o=[];return i(function(t,e,n){o.push(r(t,e,n))},t),o}},{"@ndhoule/each":6}],13:[function(t,e,n){"use strict";function i(t){return"string"==typeof t||"[object String]"===a.call(t)}var a=Object.prototype.toString;e.exports=function(t,e){if(null==e||(null==(n=e)||"object"!=typeof n))return{};var n;i(t)&&(t=[t]),n=t,"[object Array]"!==a.call(n)&&(t=[]);for(var r={},o=0;o<t.length;o+=1)i(t[o])&&t[o]in e&&(r[t[o]]=e[t[o]]);return r}},{}],14:[function(t,e,n){"use strict";var r=Math.max;e.exports=function(t){if(null==t||!t.length)return[];for(var e=new Array(r(t.length-2,0)),n=1;n<t.length;n+=1)e[n-1]=t[n];return e}},{}],15:[function(P,L,t){(function(M){(function(){"use strict";var t=M.analytics,i=P("segmentio-facade").Alias,e=P("component-emitter"),s=P("segmentio-facade"),a=P("segmentio-facade").Group,c=P("segmentio-facade").Identify,r=P("./middleware").SourceMiddlewareChain,o=P("./middleware").IntegrationMiddlewareChain,u=P("segmentio-facade").Page,l=P("segmentio-facade").Track,p=P("bind-all"),f=P("@ndhoule/clone"),d=P("extend"),n=P("./cookie"),h=P("./metrics"),y=P("debug"),g=P("@ndhoule/defaults"),m=P("@ndhoule/each"),v=P("@ndhoule/foldl"),b=P("./group"),w=P("is"),j=P("@segment/is-meta"),x=P("@ndhoule/keys"),_=P("./memory"),k=P("next-tick"),I=P("./normalize"),A=P("component-event").bind,C=P("./pageDefaults"),O=P("@ndhoule/pick"),S=P("@segment/prevent-default"),T=P("component-querystring"),E=P("./store"),D=P("./user"),N=P("component-type");function z(){this._options({}),this.Integrations={},this._sourceMiddlewares=new r,this._integrationMiddlewares=new o,this._integrations={},this._readied=!1,this._timeout=300,this._user=D,this.log=y("analytics.js"),p(this);var n=this;this.on("initialize",function(t,e){e.initialPageview&&n.page(),n._parseQuery(window.location.search)})}e(z.prototype),z.prototype.use=function(t){return t(this),this},z.prototype.addIntegration=function(t){var e=t.prototype.name;if(!e)throw new TypeError("attempted to add an invalid integration");return this.Integrations[e]=t,this},z.prototype.addSourceMiddleware=function(t){if(this.initialized)throw new Error("attempted to add a source middleware after initialization");return this._sourceMiddlewares.add(t),this},z.prototype.addIntegrationMiddleware=function(t){if(this.initialized)throw new Error("attempted to add an integration middleware after initialization");return this._integrationMiddlewares.add(t),this},z.prototype.init=z.prototype.initialize=function(n,o){n=n||{},o=o||{},this._options(o),this._readied=!1;var i=this;m(function(t,e){i.Integrations[e]||delete n[e]},n),m(function(t,e){var n,r;o.integrations&&(!1===o.integrations[e]||!1===o.integrations.All&&!o.integrations[e])||(n=i.Integrations[e],d(!0,r={},t),r=new n(r),i.log("initialize %o - %o",e,t),i.add(r))},n);var t=this._integrations;D.load(),b.load();function r(){a<=++e&&(i._readied=!0,i.emit("ready"))}var e=0,a=x(t).length;a<=0&&r();var s=!(this.failedInitializations=[]);return m(function(e){var t;o.initialPageview&&!1===e.options.initialPageview&&(t=e.page,e.page=function(){if(s)return t.apply(this,arguments);s=!0}),e.analytics=i,e.once("ready",r);try{h.increment("analytics_js.integration.invoke",{method:"initialize",integration_name:e.name}),e.initialize()}catch(t){var n=e.name;h.increment("analytics_js.integration.invoke.error",{method:"initialize",integration_name:e.name}),i.failedInitializations.push(n),i.log("Error initializing %s integration: %o",n,t),e.ready()}},t),this.initialized=!0,this.emit("initialize",n,o),this},z.prototype.setAnonymousId=function(t){return this.user().anonymousId(t),this},z.prototype.add=function(t){return this._integrations[t.name]=t,this},z.prototype.identify=function(t,e,n,r){w.fn(n)&&(r=n,n=null),w.fn(e)&&(r=e,e=n=null),w.object(t)&&(n=e,e=t,t=D.id()),D.identify(t,e);var o=this.normalize({options:n,traits:D.traits(),userId:D.id()});return this.options.integrations&&g(o.integrations,this.options.integrations),this._invoke("identify",new c(o)),this.emit("identify",t,e,n),this._callback(r),this},z.prototype.user=function(){return D},z.prototype.group=function(t,e,n,r){if(!arguments.length)return b;w.fn(n)&&(r=n,n=null),w.fn(e)&&(r=e,e=n=null),w.object(t)&&(n=e,e=t,t=b.id()),b.identify(t,e);var o=this.normalize({options:n,traits:b.traits(),groupId:b.id()});return this.options.integrations&&g(o.integrations,this.options.integrations),this._invoke("group",new a(o)),this.emit("group",t,e,n),this._callback(r),this},z.prototype.track=function(t,e,n,r){w.fn(n)&&(r=n,n=null),w.fn(e)&&(r=e,e=n=null);var o=this.options.plan||{},i=o.track||{},a={},s=this.normalize({properties:e,options:n,event:t});return(o=i[t])?(this.log("plan %o - %o",t,o),a=!1===o.enabled?{All:!1,"Segment.io":!0}:o.integrations||{}):(i.__default||{enabled:!0}).enabled||(a={All:!1,"Segment.io":!0}),g(s.integrations,this._mergeInitializeAndPlanIntegrations(a)),this._invoke("track",new l(s)),this.emit("track",t,e,n),this._callback(r),this},z.prototype.trackClick=z.prototype.trackLink=function(t,i,a){if(!t)return this;"element"===N(t)&&(t=[t]);var s=this;return m(function(o){if("element"!==N(o))throw new TypeError("Must pass HTMLElement to `analytics.trackLink`.");A(o,"click",function(t){var e=w.fn(i)?i(o):i,n=w.fn(a)?a(o):a,r=o.getAttribute("href")||o.getAttributeNS("http://www.w3.org/1999/xlink","href")||o.getAttribute("xlink:href");s.track(e,n),r&&"_blank"!==o.target&&!j(t)&&(S(t),s._callback(function(){window.location.href=r}))})},t),this},z.prototype.trackSubmit=z.prototype.trackForm=function(t,r,o){if(!t)return this;"element"===N(t)&&(t=[t]);var i=this;return m(function(n){if("element"!==N(n))throw new TypeError("Must pass HTMLElement to `analytics.trackForm`.");function t(t){S(t);var e=w.fn(r)?r(n):r,t=w.fn(o)?o(n):o;i.track(e,t),i._callback(function(){n.submit()})}var e=window.jQuery||window.Zepto;e?e(n).submit(t):A(n,"submit",t)},t),this},z.prototype.page=function(t,e,n,r,o){w.fn(r)&&(o=r,r=null),w.fn(n)&&(o=n,r=n=null),w.fn(e)&&(o=e,r=n=e=null),"object"===N(t)&&(r=e,n=t,e=t=null),"object"===N(e)&&(r=n,n=e,e=null),"string"===N(t)&&"string"!==N(e)&&(e=t,t=null),n=f(n)||{},e&&(n.name=e),t&&(n.category=t);var i=C();g(n,i);i=O(x(i),n);w.empty(i)||((r=r||{}).context=r.context||{},r.context.page=i);i=this.normalize({properties:n,category:t,options:r,name:e});return this.options.integrations&&g(i.integrations,this.options.integrations),this._invoke("page",new u(i)),this.emit("page",t,e,n,r),this._callback(o),this},z.prototype.pageview=function(t){var e={};return t&&(e.path=t),this.page(e),this},z.prototype.alias=function(t,e,n,r){w.fn(n)&&(r=n,n=null),w.fn(e)&&(r=e,e=n=null),w.object(e)&&(n=e,e=null);var o=this.normalize({options:n,previousId:e,userId:t});return this.options.integrations&&g(o.integrations,this.options.integrations),this._invoke("alias",new i(o)),this.emit("alias",t,e,n),this._callback(r),this},z.prototype.ready=function(t){return w.fn(t)&&(this._readied?k(t):this.once("ready",t)),this},z.prototype.timeout=function(t){this._timeout=t},z.prototype.debug=function(t){!arguments.length||t?y.enable("analytics:"+(t||"*")):y.disable()},z.prototype._options=function(t){return t=t||{},this.options=t,n.options(t.cookie),h.options(t.metrics),E.options(t.localStorage),D.options(t.user),b.options(t.group),this},z.prototype._callback=function(t){return w.fn(t)&&(this._timeout?setTimeout(t,this._timeout):k(t)),this},z.prototype._invoke=function(i,t){var a=this;try{this._sourceMiddlewares.applyMiddlewares(d(!0,new s({}),t),this._integrations,function(t){var r,o;null!==t?(t instanceof s||(t=new s(t)),a.emit("invoke",t),h.increment("analytics_js.invoke",{method:i}),r=t,o=a.failedInitializations||[],m(function(e,n){var t=d(!0,new s({}),r);if(t.enabled(n))if(0<=o.indexOf(n))a.log("Skipping invocation of .%s method of %s integration. Integration failed to initialize properly.",i,n);else try{a._integrationMiddlewares.applyMiddlewares(t,e.name,function(t){null!==t?(t instanceof s||(t=new s(t)),h.increment("analytics_js.integration.invoke",{method:i,integration_name:e.name}),e.invoke.call(e,i,t)):a.log('Payload to integration "%s" was null and dropped by a middleware.',n)})}catch(t){h.increment("analytics_js.integration.invoke.error",{method:i,integration_name:e.name}),a.log("Error invoking .%s method of %s integration: %o",i,n,t)}},a._integrations)):a.log('Payload with method "%s" was null and dropped by source a middleware.',i)})}catch(t){h.increment("analytics_js.invoke.error",{method:i}),a.log("Error invoking .%s method of %s integration: %o",i,name,t)}return this},z.prototype.push=function(t){var e=t.shift();this[e]&&this[e].apply(this,t)},z.prototype.reset=function(){this.user().logout(),this.group().logout()},z.prototype._parseQuery=function(t){var e=T.parse(t),n=r("ajs_trait_",e),t=r("ajs_prop_",e);return e.ajs_uid&&this.identify(e.ajs_uid,n),e.ajs_event&&this.track(e.ajs_event,t),e.ajs_aid&&D.anonymousId(e.ajs_aid),this;function r(r,t){var o=r.length;return v(function(t,e,n){return n.substr(0,o)===r&&(t[n.substr(o)]=e),t},{},t)}},z.prototype.normalize=function(t){return(t=I(t,x(this._integrations))).anonymousId&&D.anonymousId(t.anonymousId),t.anonymousId=D.anonymousId(),t.context.page=g(t.context.page||{},C()),t},z.prototype._mergeInitializeAndPlanIntegrations=function(t){if(!this.options.integrations)return t;var e,n=d({},this.options.integrations);for(e in!1===t.All&&(n={All:!1}),t)t.hasOwnProperty(e)&&!1!==this.options.integrations[e]&&(n[e]=t[e]);return n},z.prototype.noConflict=function(){return window.analytics=t,this},L.exports=z,L.exports.cookie=n,L.exports.memory=_,L.exports.store=E,L.exports.metrics=h}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./cookie":16,"./group":18,"./memory":20,"./metrics":21,"./middleware":22,"./normalize":23,"./pageDefaults":24,"./store":25,"./user":26,"@ndhoule/clone":3,"@ndhoule/defaults":4,"@ndhoule/each":6,"@ndhoule/foldl":9,"@ndhoule/keys":11,"@ndhoule/pick":13,"@segment/is-meta":35,"@segment/prevent-default":39,"bind-all":44,"component-emitter":52,"component-event":53,"component-querystring":55,"component-type":57,debug:27,extend:62,is:66,"next-tick":76,"segmentio-facade":86}],16:[function(t,e,n){"use strict";var r=t("bind-all"),o=t("@ndhoule/clone"),i=t("component-cookie"),a=t("debug")("analytics.js:cookie"),s=t("@ndhoule/defaults"),c=t("json3"),u=t("@segment/top-domain");function l(t){this.options(t)}l.prototype.options=function(t){if(0===arguments.length)return this._options;t=t||{};var e="."+u(window.location.href);"."===e&&(e=null),this._options=s(t,{maxage:31536e6,path:"/",domain:e}),this.set("ajs:test",!0),this.get("ajs:test")||(a("fallback to domain=null"),this._options.domain=null),this.remove("ajs:test")},l.prototype.set=function(t,e){try{return e=c.stringify(e),i(t,e,o(this._options)),!0}catch(t){return!1}},l.prototype.get=function(t){try{var e=i(t);return e=e?c.parse(e):null}catch(t){return null}},l.prototype.remove=function(t){try{return i(t,null,o(this._options)),!0}catch(t){return!1}},e.exports=r(new l),e.exports.Cookie=l},{"@ndhoule/clone":3,"@ndhoule/defaults":4,"@segment/top-domain":42,"bind-all":44,"component-cookie":46,debug:27,json3:67}],17:[function(t,e,n){"use strict";var r=t("@ndhoule/clone"),o=t("./cookie"),i=t("debug")("analytics:entity"),a=t("@ndhoule/defaults"),s=t("@ndhoule/extend"),c=t("./memory"),u=t("./store"),l=t("@segment/isodate-traverse");function p(t){this.options(t),this.initialize()}(e.exports=p).prototype.initialize=function(){if(o.set("ajs:cookies",!0),o.get("ajs:cookies"))return o.remove("ajs:cookies"),void(this._storage=o);u.enabled?this._storage=u:(i("warning using memory store both cookies and localStorage are disabled"),this._storage=c)},p.prototype.storage=function(){return this._storage},p.prototype.options=function(t){if(0===arguments.length)return this._options;this._options=a(t||{},this.defaults||{})},p.prototype.id=function(t){switch(arguments.length){case 0:return this._getId();case 1:return this._setId(t)}},p.prototype._getId=function(){if(!this._options.persist)return void 0===this._id?null:this._id;var t=this._getIdFromCookie();if(t)return t;t=this._getIdFromLocalStorage();return t?(this._setIdInCookies(t),t):null},p.prototype._getIdFromCookie=function(){return this.storage().get(this._options.cookie.key)},p.prototype._getIdFromLocalStorage=function(){return this._options.localStorageFallbackDisabled?null:u.get(this._options.cookie.key)},p.prototype._setId=function(t){this._options.persist?(this._setIdInCookies(t),this._setIdInLocalStorage(t)):this._id=t},p.prototype._setIdInCookies=function(t){this.storage().set(this._options.cookie.key,t)},p.prototype._setIdInLocalStorage=function(t){this._options.localStorageFallbackDisabled||u.set(this._options.cookie.key,t)},p.prototype.properties=p.prototype.traits=function(t){switch(arguments.length){case 0:return this._getTraits();case 1:return this._setTraits(t)}},p.prototype._getTraits=function(){var t=this._options.persist?u.get(this._options.localStorage.key):this._traits;return t?l(r(t)):{}},p.prototype._setTraits=function(t){t=t||{},this._options.persist?u.set(this._options.localStorage.key,t):this._traits=t},p.prototype.identify=function(t,e){e=e||{};var n=this.id();null!==n&&n!==t||(e=s(this.traits(),e)),t&&this.id(t),this.debug("identify %o, %o",t,e),this.traits(e),this.save()},p.prototype.save=function(){return!!this._options.persist&&(this._setId(this.id()),this._setTraits(this.traits()),!0)},p.prototype.logout=function(){this.id(null),this.traits({}),this.storage().remove(this._options.cookie.key),u.remove(this._options.cookie.key),u.remove(this._options.localStorage.key)},p.prototype.reset=function(){this.logout(),this.options({})},p.prototype.load=function(){this.id(this.id()),this.traits(this.traits())}},{"./cookie":16,"./memory":20,"./store":25,"@ndhoule/clone":3,"@ndhoule/defaults":4,"@ndhoule/extend":8,"@segment/isodate-traverse":36,debug:27}],18:[function(t,e,n){"use strict";var r=t("./entity"),o=t("bind-all"),i=t("debug")("analytics:group"),t=t("inherits");function a(t){this.defaults=a.defaults,this.debug=i,r.call(this,t)}a.defaults={persist:!0,cookie:{key:"ajs_group_id"},localStorage:{key:"ajs_group_properties"}},t(a,r),e.exports=o(new a),e.exports.Group=a},{"./entity":17,"bind-all":44,debug:27,inherits:64}],19:[function(t,e,n){"use strict";var r=new(t("./analytics"));r.VERSION=t("../package.json").version,e.exports=r},{"../package.json":28,"./analytics":15}],20:[function(t,e,n){"use strict";var r=t("bind-all"),o=t("@ndhoule/clone"),i=Object.prototype.hasOwnProperty;function a(){this.store={}}e.exports=r(new a),a.prototype.set=function(t,e){return this.store[t]=o(e),!0},a.prototype.get=function(t){if(i.call(this.store,t))return o(this.store[t])},a.prototype.remove=function(t){return delete this.store[t],!0}},{"@ndhoule/clone":3,"bind-all":44}],21:[function(t,e,n){"use strict";var r=t("bind-all"),o=t("@segment/send-json"),i=t("debug")("analytics.js:metrics");function a(t){this.options(t)}a.prototype.options=function(t){var e;t=t||{},this.host=t.host||"api.segment.io/v1",this.sampleRate=t.sampleRate||0,this.flushTimer=t.flushTimer||3e4,this.maxQueueSize=t.maxQueueSize||20,this.queue=[],0<this.sampleRate&&(e=this,setInterval(function(){e._flush()},this.flushTimer))},a.prototype.increment=function(t,e){Math.random()>this.sampleRate||this.queue.length>=this.maxQueueSize||(this.queue.push({type:"Counter",metric:t,value:1,tags:e}),0<t.indexOf("error")&&this._flush())},a.prototype._flush=function(){var n;this.queue.length<=0||(n={series:this.queue},this.queue=[],"xhr"===o.type&&o("https://"+this.host+"/m",n,{"Content-Type":"text/plain"},function(t,e){i("sent %O, received %O",n,[t,e])}))},e.exports=r(new a),e.exports.Metrics=a},{"@segment/send-json":40,"bind-all":44,debug:27}],22:[function(t,e,n){"use strict";var a=t("segmentio-facade");function r(t){var o=[];return t.getMiddlewares=function(){return o.slice()},t.add=function(t){if("function"!=typeof t)throw new Error("attempted to add non-function middleware");if(-1!==o.indexOf(t))throw new Error("middleware is already registered");o.push(t)},function(t,e,n){if("object"!=typeof e)throw new Error("applyMiddlewares requires a payload object");if("function"!=typeof n)throw new Error("applyMiddlewares requires a function callback");var r=o.slice();r.push(n),function e(n,t,r,o){if(null===t)return void r[r.length-1](null);t instanceof a||(t=new a(t));var i=r[o];i&&(r[o+1]?n(i,t,function(t){e(n,t,r,++o)}):i(t))}(t,e,r,0)}}e.exports.SourceMiddlewareChain=function(){var n=r(this);this.applyMiddlewares=function(t,r,e){return n(function(t,e,n){t({integrations:r,next:n,payload:e})},t,e)}},e.exports.IntegrationMiddlewareChain=function(){var n=r(this);this.applyMiddlewares=function(t,r,e){return n(function(t,e,n){t(e,r,n)},t,e)}},e.exports.middlewareChain=r},{"segmentio-facade":86}],23:[function(t,e,n){"use strict";var u=t("debug")("analytics.js:normalize"),l=t("@ndhoule/defaults"),p=t("@ndhoule/each"),f=t("@ndhoule/includes"),d=t("@ndhoule/map"),h=t("component-type"),y=t("uuid").v4,g=t("json3"),m=t("spark-md5").hash,v=Object.prototype.hasOwnProperty;e.exports=function(t,e){var n=d(function(t){return t.toLowerCase()},e),r=t.options||{},o=r.integrations||{},i=r.providers||{},a=r.context||{},s={};return u("<-",t),p(function(t,e){c(e)&&(v.call(o,e)||(o[e]=t),delete r[e])},r),delete r.providers,p(function(t,e){c(e)&&"object"!==h(o[e])&&(v.call(o,e)&&"boolean"==typeof i[e]||(o[e]=t))},i),p(function(t,e){f(e,b)?s[e]=r[e]:a[e]=r[e]},r),t.messageId="ajs-"+m(g.stringify(t)+y()),delete t.options,s.integrations=o,s.context=a,s=l(s,t),u("->",s),s;function c(t){return f(t,e)||"all"===t.toLowerCase()||f(t.toLowerCase(),n)}};var b=["integrations","anonymousId","timestamp","context"]},{"@ndhoule/defaults":4,"@ndhoule/each":6,"@ndhoule/includes":10,"@ndhoule/map":12,"component-type":57,debug:27,json3:67,"spark-md5":93,uuid:101}],24:[function(t,e,n){"use strict";var r=t("@segment/canonical"),o=t("@ndhoule/includes"),i=t("component-url");e.exports=function(){return{path:((t=r())?i.parse(t):window.location).pathname,referrer:document.referrer,search:location.search,title:document.title,url:function(t){var e=r();if(e)return o("?",e)?e:e+t;e=window.location.href,t=e.indexOf("#");return-1===t?e:e.slice(0,t)}(location.search)};var t}},{"@ndhoule/includes":10,"@segment/canonical":33,"component-url":58}],25:[function(t,e,n){"use strict";var r=t("bind-all"),o=t("@ndhoule/defaults"),i=t("@segment/store");function a(t){this.options(t)}a.prototype.options=function(t){if(0===arguments.length)return this._options;o(t=t||{},{enabled:!0}),this.enabled=t.enabled&&i.enabled,this._options=t},a.prototype.set=function(t,e){return!!this.enabled&&i.set(t,e)},a.prototype.get=function(t){return this.enabled?i.get(t):null},a.prototype.remove=function(t){return!!this.enabled&&i.remove(t)},e.exports=r(new a),e.exports.Store=a},{"@ndhoule/defaults":4,"@segment/store":41,"bind-all":44}],26:[function(t,e,n){"use strict";var r=t("./entity"),o=t("bind-all"),i=t("./cookie"),a=t("debug")("analytics:user"),s=t("inherits"),c=t("component-cookie"),u=t("uuid"),l=t("./store");function p(t){this.defaults=p.defaults,this.debug=a,r.call(this,t)}p.defaults={persist:!0,cookie:{key:"ajs_user_id",oldKey:"ajs_user"},localStorage:{key:"ajs_user_traits"}},s(p,r),p.prototype.id=function(t){var e=this._getId(),n=r.prototype.id.apply(this,arguments);return null==e||e!=t&&t&&this.anonymousId(null),n},p.prototype.anonymousId=function(t){var e=this.storage();return arguments.length?(e.set("ajs_anonymous_id",t),this._setAnonymousIdInLocalStorage(t),this):(t=e.get("ajs_anonymous_id"))?(this._setAnonymousIdInLocalStorage(t),e.set("ajs_anonymous_id",t),t):!this._options.localStorageFallbackDisabled&&(t=l.get("ajs_anonymous_id"))?(e.set("ajs_anonymous_id",t),t):(t=c("_sio"))?(t=t.split("----")[0],e.set("ajs_anonymous_id",t),this._setAnonymousIdInLocalStorage(t),e.remove("_sio"),t):(t=u.v4(),e.set("ajs_anonymous_id",t),this._setAnonymousIdInLocalStorage(t),e.get("ajs_anonymous_id"))},p.prototype._setAnonymousIdInLocalStorage=function(t){this._options.localStorageFallbackDisabled||l.set("ajs_anonymous_id",t)},p.prototype.logout=function(){r.prototype.logout.call(this),this.anonymousId(null)},p.prototype.load=function(){this._loadOldCookie()||r.prototype.load.call(this)},p.prototype._loadOldCookie=function(){var t=i.get(this._options.cookie.oldKey);return!!t&&(this.id(t.id),this.traits(t.traits),i.remove(this._options.cookie.oldKey),!0)},e.exports=o(new p),e.exports.User=p},{"./cookie":16,"./entity":17,"./store":25,"bind-all":44,"component-cookie":46,debug:27,inherits:64,uuid:101}],27:[function(t,e,n){function o(r){return o.enabled(r)?function(t){t=(n=t)instanceof Error?n.stack||n.message:n;var e=new Date,n=e-(o[r]||e);o[r]=e,t=r+" "+t+" +"+o.humanize(n),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}(e.exports=o).names=[],o.skips=[],o.enable=function(t){try{localStorage.debug=t}catch(t){}for(var e=(t||"").split(/[\s,]+/),n=e.length,r=0;r<n;r++)"-"===(t=e[r].replace("*",".*?"))[0]?o.skips.push(new RegExp("^"+t.substr(1)+"$")):o.names.push(new RegExp("^"+t+"$"))},o.disable=function(){o.enable("")},o.humanize=function(t){return 36e5<=t?(t/36e5).toFixed(1)+"h":6e4<=t?(t/6e4).toFixed(1)+"m":1e3<=t?(t/1e3|0)+"s":t+"ms"},o.enabled=function(t){for(var e=0,n=o.skips.length;e<n;e++)if(o.skips[e].test(t))return!1;for(e=0,n=o.names.length;e<n;e++)if(o.names[e].test(t))return!0;return!1};try{window.localStorage&&o.enable(localStorage.debug)}catch(t){}},{}],28:[function(t,e,n){e.exports={name:"@segment/analytics.js-core",author:"Segment <friends@segment.com>",version:"3.10.1",description:"The hassle-free way to integrate analytics into any web application.",keywords:["analytics","analytics.js","segment","segment.io"],main:"lib/index.js",scripts:{test:"make test",lint:'eslint "./{lib,test}/**/*.js"',format:'prettier-eslint --write --list-different "./{lib,test}/**/*.{js,json,md}"',precommit:"lint-staged",np:"np --no-publish",cz:"git-cz",commitmsg:"commitlint -E GIT_PARAMS"},repository:{type:"git",url:"https://github.com/segmentio/analytics.js-core"},license:"SEE LICENSE IN LICENSE",bugs:{url:"https://github.com/segmentio/analytics.js-core/issues"},homepage:"https://github.com/segmentio/analytics.js-core#readme",dependencies:{"@ndhoule/clone":"^1.0.0","@ndhoule/defaults":"^2.0.1","@ndhoule/each":"^2.0.1","@ndhoule/extend":"^2.0.0","@ndhoule/foldl":"^2.0.1","@ndhoule/includes":"^2.0.1","@ndhoule/keys":"^2.0.0","@ndhoule/map":"^2.0.1","@ndhoule/pick":"^2.0.0","@segment/canonical":"^1.0.0","@segment/is-meta":"^1.0.0","@segment/isodate":"^1.0.2","@segment/isodate-traverse":"^1.0.1","@segment/prevent-default":"^1.0.0","@segment/send-json":"^3.0.0","@segment/store":"^1.3.20","@segment/top-domain":"^3.0.0","bind-all":"^1.0.0","component-cookie":"^1.1.2","component-emitter":"^1.2.1","component-event":"^0.1.4","component-querystring":"^2.0.0","component-type":"^1.2.1","component-url":"^0.2.1",debug:"^0.7.4",extend:"3.0.2",inherits:"^2.0.1",install:"^0.7.3",is:"^3.1.0",json3:"^3.3.2","new-date":"^1.0.0","next-tick":"^0.2.2","segmentio-facade":"^3.0.2","spark-md5":"^2.0.2",uuid:"^2.0.2"},devDependencies:{"@commitlint/cli":"^7.0.0","@commitlint/config-conventional":"^7.0.1","@segment/analytics.js-integration":"^3.2.1","@segment/eslint-config":"^4.0.0",browserify:"13.0.0","browserify-istanbul":"^2.0.0",codecov:"^3.0.2",commitizen:"^2.10.1","commitlint-circle":"^1.0.0","compat-trigger-event":"^1.0.0","component-each":"^0.2.6","cz-conventional-changelog":"^2.1.0",eslint:"^4.19.1","eslint-config-prettier":"^2.9.0","eslint-plugin-mocha":"^5.0.0","eslint-plugin-react":"^7.9.1","eslint-plugin-require-path-exists":"^1.1.8",husky:"^0.14.3",istanbul:"^0.4.3",jquery:"^3.2.1",karma:"1.3.0","karma-browserify":"^5.0.4","karma-chrome-launcher":"^1.0.1","karma-coverage":"^1.0.0","karma-junit-reporter":"^1.0.0","karma-mocha":"1.0.1","karma-phantomjs-launcher":"^1.0.0","karma-sauce-launcher":"^1.0.0","karma-spec-reporter":"0.0.26","karma-summary-reporter":"^1.5.0","lint-staged":"^7.2.0",mocha:"^2.2.5",np:"^3.0.4","phantomjs-prebuilt":"^2.1.7","prettier-eslint-cli":"^4.7.1",proclaim:"^3.4.1",sinon:"^1.7.3",snyk:"^1.83.0",watchify:"^3.7.0"},commitlint:{extends:["@commitlint/config-conventional"]},"lint-staged":{linters:{"*.{js,json,md}":["prettier-eslint --write","git add"]}},config:{commitizen:{path:"cz-conventional-changelog"}}}},{}],29:[function(t,e,n){"use strict";var r=t("component-bind"),o=t("lodash.clonedeep"),i=t("debug"),a=t("@ndhoule/defaults"),s=t("@ndhoule/extend"),c=t("slug-component"),u=t("./protos"),l=t("./statics");e.exports=function(e){function n(t){if(t&&t.addIntegration)return t.addIntegration(n);this.debug=i("analytics:integration:"+c(e)),this.options=a(o(t)||{},this.defaults),this._queue=[],this.once("ready",r(this,this.flush)),n.emit("construct",this),this.ready=r(this,this.ready),this._wrapInitialize(),this._wrapPage(),this._wrapTrack()}return n.prototype.defaults={},n.prototype.globals=[],n.prototype.templates={},n.prototype.name=e,s(n,l),s(n.prototype,u),n}},{"./protos":30,"./statics":31,"@ndhoule/defaults":4,"@ndhoule/extend":8,"component-bind":45,debug:59,"lodash.clonedeep":70,"slug-component":92}],30:[function(t,e,n){"use strict";function c(){}var r=t("component-emitter"),o=t("@ndhoule/after"),u=t("@ndhoule/each"),s=t("analytics-events"),l=t("@ndhoule/every"),p=t("@segment/fmt"),f=t("@ndhoule/foldl"),d=t("is"),h=t("load-iframe"),y=t("@segment/load-script"),i=t("next-tick"),g=t("to-no-case"),m=Object.prototype.hasOwnProperty,a=window.onerror,v=null;function b(t){return!!d.object(t)&&(!!d.string(t.key)&&!!m.call(t,"value"))}r(n),n.initialize=function(){var t=this.ready;i(t)},n.loaded=function(){return!1},n.page=function(t){},n.track=function(t){},n.map=function(t,e){var i=g(e),a=function(t){if(d.array(t))return l(b,t)?"mixed":"array";return d.object(t)?"map":"unknown"}(t);return"unknown"===a?[]:f(function(t,e,n){var r,o;return"map"===a&&(r=n,o=e),"array"===a&&(o=r=e),"mixed"===a&&(r=e.key,o=e.value),g(r)===i&&t.push(o),t},[],t)},n.invoke=function(e){if(this[e]){var t,n=Array.prototype.slice.call(arguments,1);if(!this._ready)return this.queue(e,n);try{this.debug("%s with %o",e,n),t=this[e].apply(this,n)}catch(t){this.debug("error %o calling %s with %o",t,e,n)}return t}},n.queue=function(t,e){this._queue.push({method:t,args:e})},n.flush=function(){this._ready=!0;var e=this;u(function(t){e[t.method].apply(e,t.args)},this._queue),this._queue.length=0},n.reset=function(){for(var t=0;t<this.globals.length;t++)window[this.globals[t]]=void 0;window.onerror=a,window.onload=v},n.load=function(t,e,n){"function"==typeof t&&(n=t,t=e=null),t&&"object"==typeof t&&(n=e,e=t,t=null),"function"==typeof e&&(n=e,e=null),t=t||"library",e=e||{},e=this.locals(e);var r=this.templates[t];if(!r)throw new Error(p('template "%s" not defined.',t));var o,i=(o=e,f(function(t,e,n){return t[n]=e.replace(/\{\{\ *(\w+)\ *\}\}/g,function(t,e){return o[e]}),t},{},r.attrs));n=n||c;var a,s=this;switch(r.type){case"img":i.width=1,i.height=1,a=function(t,e){e=e||function(){};var n=new Image;return n.onerror=function(n,r,o){return function(t){t=t||window.event;var e=new Error(r);e.event=t,e.source=o,n(e)}}(e,"failed to load pixel",n),n.onload=function(){e()},n.src=t.src,n.width=1,n.height=1,n}(i,n);break;case"script":a=y(i,function(t){return t?void s.debug('error loading "%s" error="%s"',s.name,t):n()}),delete i.src,u(function(t,e){a.setAttribute(e,t)},i);break;case"iframe":a=h(i,n)}return a},n.locals=function(n){n=n||{};var t=Math.floor((new Date).getTime()/36e5);return n.hasOwnProperty("cache")||(n.cache=t),u(function(t,e){n.hasOwnProperty(e)||(n[e]=t)},this.options),n},n.ready=function(){this.emit("ready")},n._wrapInitialize=function(){var e=this.initialize;this.initialize=function(){this.debug("initialize"),this._initialized=!0;var t=e.apply(this,arguments);return this.emit("initialize"),t}},n._wrapPage=function(){if(this._assumesPageview)return this.page=o(2,this.page)},n._wrapTrack=function(){var a=this.track;this.track=function(t){var e,n,r,o=t.event();for(r in s)if(m.call(s,r)){var i=s[r];if(this[r]&&i.test(o)){n=this[r].apply(this,arguments),e=!0;break}}return e||(n=a.apply(this,arguments)),n}}},{"@ndhoule/after":1,"@ndhoule/each":6,"@ndhoule/every":7,"@ndhoule/foldl":9,"@segment/fmt":34,"@segment/load-script":38,"analytics-events":43,"component-emitter":52,is:66,"load-iframe":69,"next-tick":76,"to-no-case":96}],31:[function(t,e,n){"use strict";var r=t("component-emitter"),o=t("domify"),i=t("@ndhoule/each"),a=t("@ndhoule/includes");r(n),n.option=function(t,e){return this.prototype.defaults[t]=e,this},n.mapping=function(e){return this.option(e,[]),this.prototype[e]=function(t){return this.map(this.options[e],t)},this},n.global=function(t){return this.prototype.globals.push(t),this},n.assumesPageview=function(){return this.prototype._assumesPageview=!0,this},n.readyOnLoad=function(){return this.prototype._readyOnLoad=!0,this},n.readyOnInitialize=function(){return this.prototype._readyOnInitialize=!0,this},n.tag=function(t,e){return null==e&&(e=t,t="library"),this.prototype.templates[t]=function(n){n=n.replace(' src="',' data-src="');var t=o(n),r={};return i(function(t){var e="data-src"===t.name?"src":t.name;a(t.name+"=",n)&&(r[e]=t.value)},t.attributes),{type:t.tagName.toLowerCase(),attrs:r}}(e),this}},{"@ndhoule/each":6,"@ndhoule/includes":10,"component-emitter":52,domify:61}],32:[function(t,e,n){var u=t("utf8-encode"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.exports=function(t){var e,n,r,o,i,a,s="",c=0;t=u(t);for(;c<t.length;)a=t.charCodeAt(c++),e=t.charCodeAt(c++),n=t.charCodeAt(c++),r=a>>2,o=(3&a)<<4|e>>4,i=(15&e)<<2|n>>6,a=63&n,isNaN(e)?i=a=64:isNaN(n)&&(a=64),s=s+l.charAt(r)+l.charAt(o)+l.charAt(i)+l.charAt(a);return s}},{"utf8-encode":99}],33:[function(t,e,n){"use strict";e.exports=function(){for(var t,e=document.getElementsByTagName("link"),n=0;t=e[n];n++)if("canonical"===t.getAttribute("rel"))return t.getAttribute("href")}},{}],34:[function(t,n,e){(function(e){(function(){"use strict";var t=e.JSON&&"function"==typeof JSON.stringify?JSON.stringify:String;function o(t){var n=Array.prototype.slice.call(arguments,1),r=0;return t.replace(/%([a-z])/gi,function(t,e){return o[e]?o[e](n[r++]):t+e})}o.o=t,o.s=String,o.d=parseInt,n.exports=o}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(t,e,n){"use strict";e.exports=function(t){if(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)return!0;var e=t.which,t=t.button;return e||void 0===t?2===e:1&!t&&2&!t&&4&t}},{}],36:[function(t,e,n){"use strict";var o=t("component-type"),i=t("component-each"),a=t("@segment/isodate");function s(t,e){return void 0===e&&(e=!0),"object"===o(t)?function(n,r){!n.length||"number"!=typeof n.length||n.length-1 in n||(n.lengthNonArray=n.length,delete n.length);i(n,function(t,e){a.is(e,r)?n[t]=a.parse(e):"object"!==o(e)&&"array"!==o(e)||s(e,r)}),n.lengthNonArray&&(n.length=n.lengthNonArray,delete n.lengthNonArray);return n}(t,e):"array"===o(t)?(r=e,i(n=t,function(t,e){"object"===o(t)?s(t,r):a.is(t,r)&&(n[e]=a.parse(t))}),n):t;var n,r}e.exports=s},{"@segment/isodate":37,"component-each":50,"component-type":57}],37:[function(t,e,n){"use strict";var a=/^(\d{4})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:([ T])(\d{2}):?(\d{2})(?::?(\d{2})(?:[,\.](\d{1,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?)?)?$/;n.parse=function(t){var e=[1,5,6,7,11,12],n=a.exec(t),r=0;if(!n)return new Date(t);for(var o,i=0;o=e[i];i++)n[o]=parseInt(n[o],10)||0;n[2]=parseInt(n[2],10)||1,n[3]=parseInt(n[3],10)||1,n[2]--,n[8]=n[8]?(n[8]+"00").substring(0,3):0," "===n[4]?r=(new Date).getTimezoneOffset():"Z"!==n[9]&&n[10]&&(r=60*n[11]+n[12],"+"===n[10]&&(r=0-r));r=Date.UTC(n[1],n[2],n[3],n[5],n[6]+r,n[7],n[8]);return new Date(r)},n.is=function(t,e){return"string"==typeof t&&((!e||!1!==/^\d{4}-\d{2}-\d{2}/.test(t))&&a.test(t))}},{}],38:[function(t,e,n){"use strict";var o=t("script-onload"),i=t("next-tick"),a=t("component-type");e.exports=function(t,e){if(!t)throw new Error("Can't load nothing...");"string"===a(t)&&(t={src:t});var n="https:"===document.location.protocol||"chrome-extension:"===document.location.protocol;t.src&&0===t.src.indexOf("//")&&(t.src=(n?"https:":"http:")+t.src),n&&t.https?t.src=t.https:!n&&t.http&&(t.src=t.http);var r=document.createElement("script");return r.type="text/javascript",r.async=!0,r.src=t.src,"function"===a(e)&&o(r,e),i(function(){var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(r,t)}),r}},{"component-type":57,"next-tick":76,"script-onload":79}],39:[function(t,e,n){"use strict";e.exports=function(t){return(t=t||window.event).preventDefault?t.preventDefault():t.returnValue=!1}},{}],40:[function(t,e,i){"use strict";var a=t("json3"),s=t("@segment/base64-encode"),n=t("has-cors"),c=t("jsonp");function r(t,e,n,r){3===arguments.length&&(r=n,n={});var o,i=new XMLHttpRequest;for(o in i.onerror=r,i.onreadystatechange=function(){if(4===i.readyState)return r(null,i)},i.open("POST",t,!0),n)i.setRequestHeader(o,n[o]);i.send(a.stringify(e))}function o(n,t,e,r){3===arguments.length&&(r=e);var o=i.prefix,t=(e=t,t="",t=a.stringify(e),t=(t=s(t)).replace(/\+/g,"-").replace(/\//g,"_"),encodeURIComponent(t));c(n+="?"+o+"="+t,{param:i.callback},function(t,e){return t?r(t):void r(null,{url:n,body:e})})}(i=e.exports=n?r:o).callback="callback",i.prefix="data",i.json=r,i.base64=o,i.type=n?"xhr":"jsonp"},{"@segment/base64-encode":32,"has-cors":63,json3:67,jsonp:68}],41:[function(t,e,n){(function(p){(function(){"use strict";var l=t("json3");e.exports=function(){var r,n,t,i={},e="undefined"!=typeof window?window:p,o=e.document,a="localStorage";if(i.disabled=!1,i.version="1.3.20",i.set=function(t,e){},i.get=function(t,e){},i.has=function(t){return void 0!==i.get(t)},i.remove=function(t){},i.clear=function(){},i.transact=function(t,e,n){null==n&&(n=e,e=null),null==e&&(e={});e=i.get(t,e);n(e),i.set(t,e)},i.getAll=function(){var n={};return i.forEach(function(t,e){n[t]=e}),n},i.forEach=function(){},i.serialize=function(t){return l.stringify(t)},i.deserialize=function(e){if("string"==typeof e)try{return l.parse(e)}catch(t){return e||void 0}},function(){try{return a in e&&e[a]}catch(t){return}}())r=e[a],i.set=function(t,e){return void 0===e?i.remove(t):(r.setItem(t,i.serialize(e)),e)},i.get=function(t,e){t=i.deserialize(r.getItem(t));return void 0===t?e:t},i.remove=function(t){r.removeItem(t)},i.clear=function(){r.clear()},i.forEach=function(t){for(var e=0;e<r.length;e++){var n=r.key(e);t(n,i.get(n))}};else if(o&&o.documentElement.addBehavior){try{(t=new ActiveXObject("htmlfile")).open(),t.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),t.close(),n=t.w.frames[0].document,r=n.createElement("div")}catch(t){r=o.createElement("div"),n=o.body}var o=function(e){return function(){var t=Array.prototype.slice.call(arguments,0);t.unshift(r),n.appendChild(r),r.addBehavior("#default#userData"),r.load(a);t=e.apply(i,t);return n.removeChild(r),t}},s=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),c=function(t){return t.replace(/^d/,"___$&").replace(s,"___")};i.set=o(function(t,e,n){return e=c(e),void 0===n?i.remove(e):(t.setAttribute(e,i.serialize(n)),t.save(a),n)}),i.get=o(function(t,e,n){e=c(e);e=i.deserialize(t.getAttribute(e));return void 0===e?n:e}),i.remove=o(function(t,e){e=c(e),t.removeAttribute(e),t.save(a)}),i.clear=o(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(a);for(var n=e.length-1;0<=n;n--)t.removeAttribute(e[n].name);t.save(a)}),i.forEach=o(function(t,e){for(var n,r=t.XMLDocument.documentElement.attributes,o=0;n=r[o];++o)e(n.name,i.deserialize(t.getAttribute(n.name)))})}try{var u="__storejs__";i.set(u,u),i.get(u)!=u&&(i.disabled=!0),i.remove(u)}catch(t){i.disabled=!0}return i.enabled=!i.disabled,i}()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{json3:67}],42:[function(t,e,s){"use strict";var o=t("component-url").parse,t=t("component-cookie");function n(t){for(var e=s.cookie,n=s.levels(t),r=0;r<n.length;++r){var o="__tld__",i=n[r],a={domain:"."+i};if(e(o,1,a),e(o))return e(o,null,a),i}return""}n.levels=function(t){var e=o(t).hostname.split("."),t=e[e.length-1],n=[];if(4===e.length&&t===parseInt(t,10))return n;if(e.length<=1)return n;for(var r=e.length-2;0<=r;--r)n.push(e.slice(r).join("."));return n},n.cookie=t,s=e.exports=n},{"component-cookie":46,"component-url":58}],43:[function(t,e,n){"use strict";var r=t("@ndhoule/map"),t=t("@ndhoule/foldl");e.exports=t(function(t,e,n){e=r(function(t){return r(function(t){return"^[ _]?"+[].concat.apply([],r(function(t){return t.split(" ")},t)).join("[ _]?")+"[ _]?"},[[t.action,t.object],[t.object,t.action]]).join("|")},e).join("|")+"$";return t[n]=new RegExp(e,"i"),t},{},{videoPlaybackStarted:[{object:"video playback",action:"started"}],videoPlaybackPaused:[{object:"video playback",action:"paused"}],videoPlaybackInterrupted:[{object:"video playback",action:"interrupted"}],videoPlaybackResumed:[{object:"video playback",action:"resumed"}],videoPlaybackCompleted:[{object:"video playback",action:"completed"}],videoPlaybackBufferStarted:[{object:"video playback buffer",action:"started"}],videoPlaybackBufferCompleted:[{object:"video playback buffer",action:"completed"}],videoPlaybackSeekStarted:[{object:"video playback seek",action:"started"}],videoPlaybackSeekCompleted:[{object:"video playback seek",action:"completed"}],videoContentStarted:[{object:"video content",action:"started"}],videoContentPlaying:[{object:"video content",action:"playing"}],videoContentCompleted:[{object:"video content",action:"completed"}],videoAdStarted:[{object:"video ad",action:"started"}],videoAdPlaying:[{object:"video ad",action:"playing"}],videoAdCompleted:[{object:"video ad",action:"completed"}],promotionViewed:[{object:"promotion",action:"viewed"}],promotionClicked:[{object:"promotion",action:"clicked"}],productsSearched:[{object:"products",action:"searched"}],productListViewed:[{object:"product list",action:"viewed"},{object:"product category",action:"viewed"}],productListFiltered:[{object:"product list",action:"filtered"}],productClicked:[{object:"product",action:"clicked"}],productViewed:[{object:"product",action:"viewed"}],productAdded:[{object:"product",action:"added"}],productRemoved:[{object:"product",action:"removed"}],cartViewed:[{object:"cart",action:"viewed"}],orderUpdated:[{object:"order",action:"updated"}],orderCompleted:[{object:"order",action:"completed"}],orderRefunded:[{object:"order",action:"refunded"}],orderCancelled:[{object:"order",action:"cancelled"}],paymentInfoEntered:[{object:"payment info",action:"entered"}],checkoutStarted:[{object:"checkout",action:"started"}],checkoutStepViewed:[{object:"checkout step",action:"viewed"}],checkoutStepCompleted:[{object:"checkout step",action:"completed"}],couponEntered:[{object:"coupon",action:"entered"}],couponApplied:[{object:"coupon",action:"applied"}],couponDenied:[{object:"coupon",action:"denied"}],couponRemoved:[{object:"coupon",action:"removed"}],productAddedToWishlist:[{object:"product",action:"added to wishlist"}],productRemovedFromWishlist:[{object:"product",action:"removed from wishlist"}],productAddedFromWishlistToCart:[{object:"product",action:"added to cart from wishlist"},{object:"product",action:"added from wishlist to cart"}],productShared:[{object:"product",action:"shared"}],cartShared:[{object:"cart",action:"shared"}],productReviewed:[{object:"product",action:"reviewed"}],applicationInstalled:[{object:"application",action:"installed"}],applicationUpdated:[{object:"application",action:"updated"}],applicationOpened:[{object:"application",action:"opened"}],applicationBackgrounded:[{object:"application",action:"backgrounded"}],applicationUninstalled:[{object:"application",action:"uninstalled"}],applicationCrashed:[{object:"application",action:"crashed"}],installAttributed:[{object:"install",action:"attributed"}],deepLinkOpened:[{object:"deep link",action:"opened"}],pushNotificationReceived:[{object:"push notification",action:"received"}],pushNotificationTapped:[{object:"push notification",action:"tapped"}],pushNotificationBounced:[{object:"push notification",action:"bounced"}],emailBounced:[{object:"email",action:"bounced"}],emailDelivered:[{object:"email",action:"delivered"}],emailLinkClicked:[{object:"email link",action:"clicked"}],emailMarkedAsSpam:[{object:"email",action:"marked as spam"}],emailOpened:[{object:"email",action:"opened"}],unsubscribed:[{object:"",action:"unsubscribed"}]})},{"@ndhoule/foldl":9,"@ndhoule/map":12}],44:[function(t,e,n){"use strict";var r=t("component-bind");e.exports=function(t){for(var e in t)"function"==typeof t[e]&&(t[e]=r(t,t[e]));return t}},{"component-bind":45}],45:[function(t,e,n){var r=[].slice;e.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return e.apply(t,n.concat(r.call(arguments)))}}},{}],46:[function(t,e,n){var r=t("debug")("cookie");function o(){var t;try{t=document.cookie}catch(t){return"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t.stack||t),{}}return function(t){var e,n={},r=t.split(/ *; */);if(""==r[0])return n;for(var o=0;o<r.length;++o)e=r[o].split("="),n[a(e[0])]=a(e[1]);return n}(t)}function i(e){try{return encodeURIComponent(e)}catch(t){r("error `encode(%o)` - %o",e,t)}}function a(e){try{return decodeURIComponent(e)}catch(t){r("error `decode(%o)` - %o",e,t)}}e.exports=function(t,e,n){switch(arguments.length){case 3:case 2:return function(t,e,n){n=n||{};t=i(t)+"="+i(e);null==e&&(n.maxage=-1);n.maxage&&(n.expires=new Date(+new Date+n.maxage));n.path&&(t+="; path="+n.path);n.domain&&(t+="; domain="+n.domain);n.expires&&(t+="; expires="+n.expires.toUTCString());n.secure&&(t+="; secure");document.cookie=t}(t,e,n);case 1:return r=t,o()[r];default:return o()}var r}},{debug:47}],47:[function(t,e,o){function n(){var t;try{t=o.storage.debug}catch(t){}return t}(o=e.exports=t("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},o.formatArgs=function(){var t=arguments,e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+o.humanize(this.diff),!e)return t;e="color: "+this.color;t=[t[0],e,"color: inherit"].concat(Array.prototype.slice.call(t,1));var n=0,r=0;return t[0].replace(/%[a-z%]/g,function(t){"%%"!==t&&(n++,"%c"===t&&(r=n))}),t.splice(r,0,e),t},o.save=function(t){try{null==t?o.storage.removeItem("debug"):o.storage.debug=t}catch(t){}},o.load=n,o.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)},o.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),o.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],o.formatters.j=function(t){return JSON.stringify(t)},o.enable(n())},{"./debug":48}],48:[function(t,e,a){(a=e.exports=function(t){function e(){}function n(){var r=n,t=+new Date,e=t-(s||t);r.diff=e,r.prev=s,r.curr=t,s=t,null==r.useColors&&(r.useColors=a.useColors()),null==r.color&&r.useColors&&(r.color=a.colors[c++%a.colors.length]);var o=Array.prototype.slice.call(arguments);o[0]=a.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var i=0;o[0]=o[0].replace(/%([a-z%])/g,function(t,e){if("%%"===t)return t;i++;var n=a.formatters[e];return"function"==typeof n&&(e=o[i],t=n.call(r,e),o.splice(i,1),i--),t}),"function"==typeof a.formatArgs&&(o=a.formatArgs.apply(r,o)),(n.log||a.log||console.log.bind(console)).apply(r,o)}e.enabled=!1,n.enabled=!0;var r=a.enabled(t)?n:e;return r.namespace=t,r}).coerce=function(t){return t instanceof Error?t.stack||t.message:t},a.disable=function(){a.enable("")},a.enable=function(t){a.save(t);for(var e=(t||"").split(/[\s,]+/),n=e.length,r=0;r<n;r++)e[r]&&("-"===(t=e[r].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^"+t.substr(1)+"$")):a.names.push(new RegExp("^"+t+"$")))},a.enabled=function(t){var e,n;for(e=0,n=a.skips.length;e<n;e++)if(a.skips[e].test(t))return!1;for(e=0,n=a.names.length;e<n;e++)if(a.names[e].test(t))return!0;return!1},a.humanize=t("ms"),a.names=[],a.skips=[],a.formatters={};var s,c=0},{ms:49}],49:[function(t,e,n){var r=36e5,o=864e5;function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}e.exports=function(t,e){return e=e||{},"string"==typeof t?function(t){if(1e4<(t=""+t).length)return;t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!t)return;var e=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"days":case"day":case"d":return e*o;case"hours":case"hour":case"hrs":case"hr":case"h":return e*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e}}(t):e.long?i(e=t,o,"day")||i(e,r,"hour")||i(e,6e4,"minute")||i(e,1e3,"second")||e+" ms":o<=(t=t)?Math.round(t/o)+"d":r<=t?Math.round(t/r)+"h":6e4<=t?Math.round(t/6e4)+"m":1e3<=t?Math.round(t/1e3)+"s":t+"ms"}},{}],50:[function(e,t,n){try{var r=e("type")}catch(t){r=e("component-type")}var o=e("to-function"),i=Object.prototype.hasOwnProperty;function a(t,e,n){for(var r=0;r<t.length;++r)e.call(n,t[r],r)}t.exports=function(t,e,n){switch(e=o(e),n=n||this,r(t)){case"array":return a(t,e,n);case"object":return"number"==typeof t.length?a(t,e,n):function(t,e,n){for(var r in t)i.call(t,r)&&e.call(n,r,t[r])}(t,e,n);case"string":return function(t,e,n){for(var r=0;r<t.length;++r)e.call(n,t.charAt(r),r)}(t,e,n)}}},{"component-type":51,"to-function":95,type:51}],51:[function(t,e,n){var r=Object.prototype.toString;e.exports=function(t){switch(r.call(t)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}return null===t?"null":void 0===t?"undefined":t&&1===t.nodeType?"element":t===Object(t)?"object":typeof t}},{}],52:[function(t,e,n){function r(t){if(t)return function(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}(t)}void 0!==e&&(e.exports=r),r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o=0;o<r.length;o++)if((n=r[o])===e||n.fn===e){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,e);return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},{}],53:[function(t,e,n){var o=window.addEventListener?"addEventListener":"attachEvent",i=window.removeEventListener?"removeEventListener":"detachEvent",a="addEventListener"!=o?"on":"";n.bind=function(t,e,n,r){return t[o](a+e,n,r||!1),n},n.unbind=function(t,e,n,r){return t[i](a+e,n,r||!1),n}},{}],54:[function(t,e,n){var a=/\b(Array|Date|Object|Math|JSON)\b/g;e.exports=function(t,e){var n,r,o,i=function(t){for(var e=[],n=0;n<t.length;n++)~e.indexOf(t[n])||e.push(t[n]);return e}(t.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\//g,"").replace(a,"").match(/[a-zA-Z_]\w*/g)||[]);return e&&"string"==typeof e&&(n=e,e=function(t){return n+t}),e?(r=i,o=e,t.replace(/\.\w+|\w+ *\(|"[^"]*"|'[^']*'|\/([^/]+)\/|[a-zA-Z_]\w*/g,function(t){return"("==t[t.length-1]||~r.indexOf(t)?o(t):t})):i}},{}],55:[function(t,e,n){function i(e){try{return encodeURIComponent(e)}catch(t){return e}}function a(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}}var s=t("trim"),c=t("type"),u=/(\w+)\[(\d+)\]/;n.parse=function(t){if("string"!=typeof t)return{};if(""==(t=s(t)))return{};"?"==t.charAt(0)&&(t=t.slice(1));for(var e={},n=t.split("&"),r=0;r<n.length;r++){var o=n[r].split("="),i=a(o[0]);(i=u.exec(i))?(e[i[1]]=e[i[1]]||[],e[i[1]][i[2]]=a(o[1])):e[o[0]]=null==o[1]?"":a(o[1])}return e},n.stringify=function(t){if(!t)return"";var e,n=[];for(e in t){var r=t[e];if("array"!=c(r))n.push(i(e)+"="+i(t[e]));else for(var o=0;o<r.length;++o)n.push(i(e+"["+o+"]")+"="+i(r[o]))}return n.join("&")}},{trim:97,type:56}],56:[function(t,e,n){var r=Object.prototype.toString;e.exports=function(t){switch(r.call(t)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===t?"null":void 0===t?"undefined":t!=t?"nan":t&&1===t.nodeType?"element":typeof(t=t.valueOf?t.valueOf():Object.prototype.valueOf.apply(t))}},{}],57:[function(t,e,n){var r=Object.prototype.toString;e.exports=function(t){switch(r.call(t)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===t?"null":void 0===t?"undefined":t!=t?"nan":t&&1===t.nodeType?"element":null!=(e=t)&&(e._isBuffer||e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e))?"buffer":typeof(t=t.valueOf?t.valueOf():Object.prototype.valueOf.apply(t));var e}},{}],58:[function(t,e,n){n.parse=function(t){var e=document.createElement("a");return e.href=t,{href:e.href,host:e.host||location.host,port:"0"===e.port||""===e.port?function(t){switch(t){case"http:":return 80;case"https:":return 443;default:return location.port}}(e.protocol):e.port,hash:e.hash,hostname:e.hostname||location.hostname,pathname:"/"!=e.pathname.charAt(0)?"/"+e.pathname:e.pathname,protocol:(e.protocol&&":"!=e.protocol?e:location).protocol,search:e.search,query:e.search.slice(1)}},n.isAbsolute=function(t){return 0==t.indexOf("//")||!!~t.indexOf("://")},n.isRelative=function(t){return!n.isAbsolute(t)},n.isCrossDomain=function(t){t=n.parse(t);var e=n.parse(window.location.href);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol}},{}],59:[function(n,r,o){(function(e){(function(){function t(){var t;try{t=o.storage.debug}catch(t){}return!t&&void 0!==e&&"env"in e&&(t=e.env.DEBUG),t}(o=r.exports=n("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},o.formatArgs=function(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+o.humanize(this.diff),!e)return;e="color: "+this.color;t.splice(1,0,e,"color: inherit");var n=0,r=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(n++,"%c"===t&&(r=n))}),t.splice(r,0,e)},o.save=function(t){try{null==t?o.storage.removeItem("debug"):o.storage.debug=t}catch(t){}},o.load=t,o.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},o.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),o.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],o.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},o.enable(t())}).call(this)}).call(this,n("_process"))},{"./debug":60,_process:78}],60:[function(t,e,s){var c;function n(t){function a(){if(a.enabled){var r=a,t=+new Date,e=t-(c||t);r.diff=e,r.prev=c,r.curr=t,c=t;for(var o=new Array(arguments.length),n=0;n<o.length;n++)o[n]=arguments[n];o[0]=s.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var i=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(t,e){if("%%"===t)return t;i++;var n=s.formatters[e];return"function"==typeof n&&(e=o[i],t=n.call(r,e),o.splice(i,1),i--),t}),s.formatArgs.call(r,o),(a.log||s.log||console.log.bind(console)).apply(r,o)}}return a.namespace=t,a.enabled=s.enabled(t),a.useColors=s.useColors(),a.color=function(t){var e,n=0;for(e in t)n=(n<<5)-n+t.charCodeAt(e),n|=0;return s.colors[Math.abs(n)%s.colors.length]}(t),"function"==typeof s.init&&s.init(a),a}(s=e.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},s.disable=function(){s.enable("")},s.enable=function(t){s.save(t),s.names=[],s.skips=[];for(var e=("string"==typeof t?t:"").split(/[\s,]+/),n=e.length,r=0;r<n;r++)e[r]&&("-"===(t=e[r].replace(/\*/g,".*?"))[0]?s.skips.push(new RegExp("^"+t.substr(1)+"$")):s.names.push(new RegExp("^"+t+"$")))},s.enabled=function(t){var e,n;for(e=0,n=s.skips.length;e<n;e++)if(s.skips[e].test(t))return!1;for(e=0,n=s.names.length;e<n;e++)if(s.names[e].test(t))return!0;return!1},s.humanize=t("ms"),s.names=[],s.skips=[],s.formatters={}},{ms:71}],61:[function(t,e,n){var r=!(e.exports=function(t,e){if("string"!=typeof t)throw new TypeError("String expected");e=e||document;var n=/<([\w:]+)/.exec(t);if(!n)return e.createTextNode(t);t=t.replace(/^\s+|\s+$/g,"");var r=n[1];if("body"==r)return(o=e.createElement("html")).innerHTML=t,o.removeChild(o.lastChild);var o,n=s[r]||s._default,i=n[0],r=n[1],n=n[2];(o=e.createElement("div")).innerHTML=r+t+n;for(;i--;)o=o.lastChild;if(o.firstChild==o.lastChild)return o.removeChild(o.firstChild);var a=e.createDocumentFragment();for(;o.firstChild;)a.appendChild(o.removeChild(o.firstChild));return a});"undefined"!=typeof document&&((e=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',r=!e.getElementsByTagName("link").length,e=void 0);var s={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:r?[1,"X<div>","</div>"]:[0,"",""]};s.td=s.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],s.option=s.optgroup=[1,'<select multiple="multiple">',"</select>"],s.thead=s.tbody=s.colgroup=s.caption=s.tfoot=[1,"<table>","</table>"],s.polyline=s.ellipse=s.polygon=s.circle=s.text=s.line=s.path=s.rect=s.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],62:[function(t,e,n){"use strict";function f(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===i.call(t)}function d(t){if(t&&"[object Object]"===i.call(t)){var e,n=o.call(t,"constructor"),r=t.constructor&&t.constructor.prototype&&o.call(t.constructor.prototype,"isPrototypeOf");if(!t.constructor||n||r){for(e in t);return void 0===e||o.call(t,e)}}}function h(t,e){r&&"__proto__"===e.name?r(t,e.name,{enumerable:!0,configurable:!0,value:e.newValue,writable:!0}):t[e.name]=e.newValue}function y(t,e){if("__proto__"===e){if(!o.call(t,e))return;if(a)return a(t,e).value}return t[e]}var o=Object.prototype.hasOwnProperty,i=Object.prototype.toString,r=Object.defineProperty,a=Object.getOwnPropertyDescriptor;e.exports=function t(e,n){var r,o,i,a,s,c=e,u=1,l=arguments.length,p=!1;for("boolean"==typeof c&&(p=c,c=n||{},u=2),(null==c||"object"!=typeof c&&"function"!=typeof c)&&(c={});u<l;++u)if(null!=(r=arguments[u]))for(o in r)s=y(c,o),c!==(i=y(r,o))&&(p&&i&&(d(i)||(a=f(i)))?(s=a?(a=!1,s&&f(s)?s:[]):s&&d(s)?s:{},h(c,{name:o,newValue:t(p,s,i)})):void 0!==i&&h(c,{name:o,newValue:i}));return c}},{}],63:[function(t,e,n){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},{}],64:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,e){var n;e&&(t.super_=e,(n=function(){}).prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t)}},{}],65:[function(t,e,n){e.exports=function(t){return/.+\@.+\..+/.test(t)}},{}],66:[function(t,e,n){"use strict";
/**!
 * is
 * the definitive JavaScript type testing library
 *
 * @copyright 2013-2014 Enrico Marino / Jordan Harband
 * @license MIT
 */var r,o,i=Object.prototype,a=i.hasOwnProperty,s=i.toString;"function"==typeof Symbol&&(r=Symbol.prototype.valueOf),"function"==typeof BigInt&&(o=BigInt.prototype.valueOf);function c(t){return t!=t}var u={boolean:1,number:1,string:1,undefined:1},l=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/,p=/^[A-Fa-f0-9]+$/,f={};f.a=f.type=function(t,e){return typeof t===e},f.defined=function(t){return void 0!==t},f.empty=function(t){var e,n=s.call(t);if("[object Array]"===n||"[object Arguments]"===n||"[object String]"===n)return 0===t.length;if("[object Object]"!==n)return!t;for(e in t)if(a.call(t,e))return!1;return!0},f.equal=function(t,e){if(t===e)return!0;var n,r=s.call(t);if(r!==s.call(e))return!1;if("[object Object]"===r){for(n in t)if(!(f.equal(t[n],e[n])&&n in e))return!1;for(n in e)if(!(f.equal(t[n],e[n])&&n in t))return!1;return!0}if("[object Array]"!==r)return"[object Function]"===r?t.prototype===e.prototype:"[object Date]"===r&&t.getTime()===e.getTime();if((n=t.length)!==e.length)return!1;for(;n--;)if(!f.equal(t[n],e[n]))return!1;return!0},f.hosted=function(t,e){var n=typeof e[t];return"object"==n?!!e[t]:!u[n]},f.instance=f.instanceof=function(t,e){return t instanceof e},f.nil=f.null=function(t){return null===t},f.undef=f.undefined=function(t){return void 0===t},f.args=f.arguments=function(t){var e="[object Arguments]"===s.call(t),t=!f.array(t)&&f.arraylike(t)&&f.object(t)&&f.fn(t.callee);return e||t},f.array=Array.isArray||function(t){return"[object Array]"===s.call(t)},f.args.empty=function(t){return f.args(t)&&0===t.length},f.array.empty=function(t){return f.array(t)&&0===t.length},f.arraylike=function(t){return!!t&&!f.bool(t)&&a.call(t,"length")&&isFinite(t.length)&&f.number(t.length)&&0<=t.length},f.bool=f.boolean=function(t){return"[object Boolean]"===s.call(t)},f.false=function(t){return f.bool(t)&&!1===Boolean(Number(t))},f.true=function(t){return f.bool(t)&&!0===Boolean(Number(t))},f.date=function(t){return"[object Date]"===s.call(t)},f.date.valid=function(t){return f.date(t)&&!isNaN(Number(t))},f.element=function(t){return void 0!==t&&"undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&1===t.nodeType},f.error=function(t){return"[object Error]"===s.call(t)},f.fn=f.function=function(t){if("undefined"!=typeof window&&t===window.alert)return!0;t=s.call(t);return"[object Function]"===t||"[object GeneratorFunction]"===t||"[object AsyncFunction]"===t},f.number=function(t){return"[object Number]"===s.call(t)},f.infinite=function(t){return t===1/0||t===-1/0},f.decimal=function(t){return f.number(t)&&!c(t)&&!f.infinite(t)&&t%1!=0},f.divisibleBy=function(t,e){var n=f.infinite(t),r=f.infinite(e),o=f.number(t)&&!c(t)&&f.number(e)&&!c(e)&&0!==e;return n||r||o&&t%e==0},f.integer=f.int=function(t){return f.number(t)&&!c(t)&&t%1==0},f.maximum=function(t,e){if(c(t))throw new TypeError("NaN is not a valid value");if(!f.arraylike(e))throw new TypeError("second argument must be array-like");for(var n=e.length;0<=--n;)if(t<e[n])return!1;return!0},f.minimum=function(t,e){if(c(t))throw new TypeError("NaN is not a valid value");if(!f.arraylike(e))throw new TypeError("second argument must be array-like");for(var n=e.length;0<=--n;)if(t>e[n])return!1;return!0},f.nan=function(t){return!f.number(t)||t!=t},f.even=function(t){return f.infinite(t)||f.number(t)&&t==t&&t%2==0},f.odd=function(t){return f.infinite(t)||f.number(t)&&t==t&&t%2!=0},f.ge=function(t,e){if(c(t)||c(e))throw new TypeError("NaN is not a valid value");return!f.infinite(t)&&!f.infinite(e)&&e<=t},f.gt=function(t,e){if(c(t)||c(e))throw new TypeError("NaN is not a valid value");return!f.infinite(t)&&!f.infinite(e)&&e<t},f.le=function(t,e){if(c(t)||c(e))throw new TypeError("NaN is not a valid value");return!f.infinite(t)&&!f.infinite(e)&&t<=e},f.lt=function(t,e){if(c(t)||c(e))throw new TypeError("NaN is not a valid value");return!f.infinite(t)&&!f.infinite(e)&&t<e},f.within=function(t,e,n){if(c(t)||c(e)||c(n))throw new TypeError("NaN is not a valid value");if(!f.number(t)||!f.number(e)||!f.number(n))throw new TypeError("all arguments must be numbers");return f.infinite(t)||f.infinite(e)||f.infinite(n)||e<=t&&t<=n},f.object=function(t){return"[object Object]"===s.call(t)},f.primitive=function(t){return!t||!("object"==typeof t||f.object(t)||f.fn(t)||f.array(t))},f.hash=function(t){return f.object(t)&&t.constructor===Object&&!t.nodeType&&!t.setInterval},f.regexp=function(t){return"[object RegExp]"===s.call(t)},f.string=function(t){return"[object String]"===s.call(t)},f.base64=function(t){return f.string(t)&&(!t.length||l.test(t))},f.hex=function(t){return f.string(t)&&(!t.length||p.test(t))},f.symbol=function(t){return"function"==typeof Symbol&&"[object Symbol]"===s.call(t)&&"symbol"==typeof r.call(t)},f.bigint=function(t){return"function"==typeof BigInt&&"[object BigInt]"===s.call(t)&&"bigint"==typeof o.call(t)},e.exports=f},{}],67:[function(t,s,c){(function(a){(function(){(function(){var t,e,n,r,F={function:!0,object:!0},o=F[typeof c]&&c&&!c.nodeType&&c,R=F[typeof window]&&window||this,i=o&&F[typeof s]&&s&&!s.nodeType&&"object"==typeof a&&a;function q(t,c){t=t||R.Object(),c=c||R.Object();var u=t.Number||R.Number,l=t.String||R.String,e=t.Object||R.Object,y=t.Date||R.Date,n=t.SyntaxError||R.SyntaxError,g=t.TypeError||R.TypeError,d=t.Math||R.Math,t=t.JSON||R.JSON;"object"==typeof t&&t&&(c.stringify=t.stringify,c.parse=t.parse);var m,e=e.prototype,v=e.toString,s=e.hasOwnProperty;function b(t,e){try{t()}catch(t){e&&e()}}var p,w,j,x,f,_,r,h,k,o,i,a,I,A,C,O,S,T,E,D,N,z,M,P=new y(-0xc782b5b800cec);function L(t){return null!=L[t]?L[t]:("bug-string-char-index"==t?e="a"!="a"[0]:"json"==t?e=L("json-stringify")&&L("date-serialization")&&L("json-parse"):"date-serialization"==t?(e=L("json-stringify")&&P)&&(o=c.stringify,b(function(){e='"-271821-04-20T00:00:00.000Z"'==o(new y(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==o(new y(864e13))&&'"-000001-01-01T00:00:00.000Z"'==o(new y(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==o(new y(-1))})):(r='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}',"json-stringify"==t&&((i="function"==typeof(o=c.stringify))&&((n=function(){return 1}).toJSON=n,b(function(){i="0"===o(0)&&"0"===o(new u)&&'""'==o(new l)&&o(v)===m&&o(m)===m&&o()===m&&"1"===o(n)&&"[1]"==o([n])&&"[null]"==o([m])&&"null"==o(null)&&"[null,null,null]"==o([m,v,null])&&o({a:[n,!0,!1,null,"\0\b\n\f\r\t"]})==r&&"1"===o(null,n)&&"[\n 1,\n 2\n]"==o([1,2],null,1)},function(){i=!1})),e=i),"json-parse"==t&&("function"==typeof(a=c.parse)&&b(function(){0!==a("0")||a(!1)||(n=a(r),(s=5==n.a.length&&1===n.a[0])&&(b(function(){s=!a('"\t"')}),s&&b(function(){s=1!==a("01")}),s&&b(function(){s=1!==a("1.")})))},function(){s=!1}),e=s)),L[t]=!!e);var e,n,r,o,i,a,s}function U(t){return k(this)}return b(function(){P=-109252==P.getUTCFullYear()&&0===P.getUTCMonth()&&1===P.getUTCDate()&&10==P.getUTCHours()&&37==P.getUTCMinutes()&&6==P.getUTCSeconds()&&708==P.getUTCMilliseconds()}),L["bug-string-char-index"]=L["date-serialization"]=L.json=L["json-stringify"]=L["json-parse"]=null,L("json")||(p="[object Function]",w="[object Number]",j="[object String]",x="[object Array]",f=L("bug-string-char-index"),_=function(t,e){var n,a,r,o=0;for(r in(n=function(){this.valueOf=0}).prototype.valueOf=0,a=new n)s.call(a,r)&&o++;return n=a=null,(_=o?function(t,e){var n,r,o=v.call(t)==p;for(n in t)o&&"prototype"==n||!s.call(t,n)||(r="constructor"===n)||e(n);(r||s.call(t,n="constructor"))&&e(n)}:(a=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],function(t,e){var n,r,o=v.call(t)==p,i=!o&&"function"!=typeof t.constructor&&F[typeof t.hasOwnProperty]&&t.hasOwnProperty||s;for(n in t)o&&"prototype"==n||!i.call(t,n)||e(n);for(r=a.length;n=a[--r];)i.call(t,n)&&e(n)}))(t,e)},L("json-stringify")||L("date-serialization")||(r={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},h=function(t,e){return("000000"+(e||0)).slice(-t)},k=function(t){var e,n,r,o,i,a,s,c,u,l,p,f;return f=P?function(t){e=t.getUTCFullYear(),n=t.getUTCMonth(),r=t.getUTCDate(),i=t.getUTCHours(),a=t.getUTCMinutes(),s=t.getUTCSeconds(),c=t.getUTCMilliseconds()}:(u=d.floor,l=[0,31,59,90,120,151,181,212,243,273,304,334],p=function(t,e){return l[e]+365*(t-1970)+u((t-1969+(e=+(1<e)))/4)-u((t-1901+e)/100)+u((t-1601+e)/400)},function(t){for(r=u(t/864e5),e=u(r/365.2425)+1970-1;p(e+1,0)<=r;e++);for(n=u((r-p(e,0))/30.42);p(e,n+1)<=r;n++);r=1+r-p(e,n),i=u((o=(t%864e5+864e5)%864e5)/36e5)%24,a=u(o/6e4)%60,s=u(o/1e3)%60,c=o%1e3}),(k=function(t){return-1/0<t&&t<1/0?(f(t),t=(e<=0||1e4<=e?(e<0?"-":"+")+h(6,e<0?-e:e):h(4,e))+"-"+h(2,n+1)+"-"+h(2,r)+"T"+h(2,i)+":"+h(2,a)+":"+h(2,s)+"."+h(3,c)+"Z",e=n=r=i=a=s=c=null):t=null,t})(t)},L("json-stringify")&&!L("date-serialization")?(o=c.stringify,c.stringify=function(t,e,n){var r=y.prototype.toJSON;y.prototype.toJSON=U;n=o(t,e,n);return y.prototype.toJSON=r,n}):(i=function(t){var e=t.charCodeAt(0),t=r[e];return t||"\\u00"+h(2,e.toString(16))},a=/[\x00-\x1f\x22\x5c]/g,I=function(t){return a.lastIndex=0,'"'+(a.test(t)?t.replace(a,i):t)+'"'},A=function(t,e,n,r,o,i,a){var s,c,u,l,p,f,d,h;if(b(function(){s=e[t]}),"object"==typeof s&&s&&(s.getUTCFullYear&&"[object Date]"==v.call(s)&&s.toJSON===y.prototype.toJSON?s=k(s):"function"==typeof s.toJSON&&(s=s.toJSON(t))),n&&(s=n.call(e,t,s)),s==m)return s===m?s:"null";switch("object"==(d=typeof s)&&(c=v.call(s)),c||d){case"boolean":case"[object Boolean]":return""+s;case"number":case w:return-1/0<s&&s<1/0?""+s:"null";case"string":case j:return I(""+s)}if("object"==typeof s){for(f=a.length;f--;)if(a[f]===s)throw g();if(a.push(s),u=[],d=i,i+=o,c==x){for(p=0,f=s.length;p<f;p++)l=A(p,s,n,r,o,i,a),u.push(l===m?"null":l);h=u.length?o?"[\n"+i+u.join(",\n"+i)+"\n"+d+"]":"["+u.join(",")+"]":"[]"}else _(r||s,function(t){var e=A(t,s,n,r,o,i,a);e!==m&&u.push(I(t)+":"+(o?" ":"")+e)}),h=u.length?o?"{\n"+i+u.join(",\n"+i)+"\n"+d+"}":"{"+u.join(",")+"}":"{}";return a.pop(),h}},c.stringify=function(t,e,n){var r,o,i,a;if(F[typeof e]&&e)if((a=v.call(e))==p)o=e;else if(a==x){i={};for(var s,c=0,u=e.length;c<u;)s=e[c++],"[object String]"!=(a=v.call(s))&&"[object Number]"!=a||(i[s]=1)}if(n)if((a=v.call(n))==w){if(0<(n-=n%1))for(10<n&&(n=10),r="";r.length<n;)r+=" "}else a==j&&(r=n.length<=10?n:n.slice(0,10));return A("",((s={})[""]=t,s),o,i,r,"",[])})),L("json-parse")||(C=l.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},E=function(){throw S=T=null,n()},D=function(){for(var t,e,n,r,o,i=T,a=i.length;S<a;)switch(o=i.charCodeAt(S)){case 9:case 10:case 13:case 32:S++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=f?i.charAt(S):i[S],S++,t;case 34:for(t="@",S++;S<a;)if((o=i.charCodeAt(S))<32)E();else if(92==o)switch(o=i.charCodeAt(++S)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=O[o],S++;break;case 117:for(e=++S,n=S+4;S<n;S++)48<=(o=i.charCodeAt(S))&&o<=57||97<=o&&o<=102||65<=o&&o<=70||E();t+=C("0x"+i.slice(e,S));break;default:E()}else{if(34==o)break;for(o=i.charCodeAt(S),e=S;32<=o&&92!=o&&34!=o;)o=i.charCodeAt(++S);t+=i.slice(e,S)}if(34==i.charCodeAt(S))return S++,t;E();default:if(e=S,45==o&&(r=!0,o=i.charCodeAt(++S)),48<=o&&o<=57){for(48==o&&(48<=(o=i.charCodeAt(S+1))&&o<=57)&&E(),r=!1;S<a&&(48<=(o=i.charCodeAt(S))&&o<=57);S++);if(46==i.charCodeAt(S)){for(n=++S;n<a&&!((o=i.charCodeAt(n))<48||57<o);n++);n==S&&E(),S=n}if(101==(o=i.charCodeAt(S))||69==o){for(43!=(o=i.charCodeAt(++S))&&45!=o||S++,n=S;n<a&&!((o=i.charCodeAt(n))<48||57<o);n++);n==S&&E(),S=n}return+i.slice(e,S)}r&&E();var s=i.slice(S,S+4);if("true"==s)return S+=4,!0;if("fals"==s&&101==i.charCodeAt(S+4))return S+=5,!1;if("null"==s)return S+=4,null;E()}return"$"},N=function(t){var e,n;if("$"==t&&E(),"string"==typeof t){if("@"==(f?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];"]"!=(t=D());)n?","==t&&"]"!=(t=D())||E():n=!0,","==t&&E(),e.push(N(t));return e}if("{"==t){for(e={};"}"!=(t=D());)n?","==t&&"}"!=(t=D())||E():n=!0,","!=t&&"string"==typeof t&&"@"==(f?t.charAt(0):t[0])&&":"==D()||E(),e[t.slice(1)]=N(D());return e}E()}return t},z=function(t,e,n){n=M(t,e,n);n===m?delete t[e]:t[e]=n},M=function(t,e,n){var r,o=t[e];if("object"==typeof o&&o)if(v.call(o)==x)for(r=o.length;r--;)z(v,_,o);else _(o,function(t){z(o,t,n)});return n.call(t,e,o)},c.parse=function(t,e){var n;return S=0,T=""+t,n=N(D()),"$"!=D()&&E(),S=T=null,e&&v.call(e)==p?M(((t={})[""]=n,t),"",e):n})),c.runInContext=q,c}!i||i.global!==i&&i.window!==i&&i.self!==i||(R=i),o?q(R,o):(t=R.JSON,e=R.JSON3,n=!1,r=q(R,R.JSON3={noConflict:function(){return n||(n=!0,R.JSON=t,R.JSON3=e,t=e=null),r}}),R.JSON={parse:r.parse,stringify:r.stringify})}).call(this)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],68:[function(t,e,n){var l=t("debug")("jsonp");e.exports=function(t,e,n){"function"==typeof e&&(n=e,e={});e=e||{};var r,o,i=e.prefix||"__jp",a=e.name||i+p++,s=e.param||"callback",c=null!=e.timeout?e.timeout:6e4,i=encodeURIComponent,e=document.getElementsByTagName("script")[0]||document.head;c&&(o=setTimeout(function(){u(),n&&n(new Error("Timeout"))},c));function u(){r.parentNode&&r.parentNode.removeChild(r),window[a]=f,o&&clearTimeout(o)}return window[a]=function(t){l("jsonp got",t),u(),n&&n(null,t)},t=(t+=(~t.indexOf("?")?"&":"?")+s+"="+i(a)).replace("?&","?"),l('jsonp req "%s"',t),(r=document.createElement("script")).src=t,e.parentNode.insertBefore(r,e),function(){window[a]&&u()}};var p=0;function f(){}},{debug:59}],69:[function(t,e,n){var o=t("is"),i=t("script-onload"),a=t("next-tick");e.exports=function(t,e){if(!t)throw new Error("Cant load nothing...");o.string(t)&&(t={src:t});var n="https:"===document.location.protocol||"chrome-extension:"===document.location.protocol;t.src&&0===t.src.indexOf("//")&&(t.src=n?"https:"+t.src:"http:"+t.src),n&&t.https?t.src=t.https:!n&&t.http&&(t.src=t.http);var r=document.createElement("iframe");return r.src=t.src,r.width=t.width||1,r.height=t.height||1,r.style.display="none",o.fn(e)&&i(r,e),a(function(){var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(r,t)}),r}},{is:66,"next-tick":76,"script-onload":79}],70:[function(t,Pt,Lt){(function(Mt){(function(){var r="__lodash_hash_undefined__",u=9007199254740991,d="[object Arguments]",h="[object Boolean]",y="[object Date]",g="[object Function]",m="[object GeneratorFunction]",v="[object Map]",b="[object Number]",w="[object Object]",n="[object Promise]",j="[object RegExp]",x="[object Set]",_="[object String]",k="[object Symbol]",o="[object WeakMap]",I="[object ArrayBuffer]",A="[object DataView]",C="[object Float32Array]",O="[object Float64Array]",S="[object Int8Array]",T="[object Int16Array]",E="[object Int32Array]",D="[object Uint8Array]",N="[object Uint8ClampedArray]",z="[object Uint16Array]",M="[object Uint32Array]",P=/\w*$/,i=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,L={};L[d]=L["[object Array]"]=L[I]=L[A]=L[h]=L[y]=L[C]=L[O]=L[S]=L[T]=L[E]=L[v]=L[b]=L[w]=L[j]=L[x]=L[_]=L[k]=L[D]=L[N]=L[z]=L[M]=!0,L["[object Error]"]=L[g]=L[o]=!1;var t="object"==typeof Mt&&Mt&&Mt.Object===Object&&Mt,e="object"==typeof self&&self&&self.Object===Object&&self,a=t||e||Function("return this")(),s="object"==typeof Lt&&Lt&&!Lt.nodeType&&Lt,c=s&&"object"==typeof Pt&&Pt&&!Pt.nodeType&&Pt,p=c&&c.exports===s;function U(t,e){return t.set(e[0],e[1]),t}function F(t,e){return t.add(e),t}function R(t,e,n,r){var o=-1,i=t?t.length:0;for(r&&i&&(n=t[++o]);++o<i;)n=e(n,t[o],o,t);return n}function q(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function B(t){var n=-1,r=Array(t.size);return t.forEach(function(t,e){r[++n]=[e,t]}),r}function f(e,n){return function(t){return e(n(t))}}function $(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var J=Array.prototype,t=Function.prototype,Z=Object.prototype,e=a["__core-js_shared__"],V=(c=/[^.]+$/.exec(e&&e.keys&&e.keys.IE_PROTO||""))?"Symbol(src)_1."+c:"",H=t.toString,X=Z.hasOwnProperty,W=Z.toString,G=RegExp("^"+H.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),s=p?a.Buffer:void 0,e=a.Symbol,K=a.Uint8Array,Q=f(Object.getPrototypeOf,Object),Y=Object.create,tt=Z.propertyIsEnumerable,et=J.splice,c=Object.getOwnPropertySymbols,t=s?s.isBuffer:void 0,nt=f(Object.keys,Object),p=_t(a,"DataView"),rt=_t(a,"Map"),J=_t(a,"Promise"),s=_t(a,"Set"),a=_t(a,"WeakMap"),ot=_t(Object,"create"),it=Ct(p),at=Ct(rt),st=Ct(J),ct=Ct(s),ut=Ct(a),e=e?e.prototype:void 0,lt=e?e.valueOf:void 0;function pt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function ft(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function dt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function ht(t){this.__data__=new ft(t)}function yt(t,e){var n,r,o,i,a=St(t)||function(t){return function(t){return!!t&&"object"==typeof t}(t)&&Tt(t)}(n=t)&&X.call(n,"callee")&&(!tt.call(n,"callee")||W.call(n)==d)?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],s=a.length,c=!!s;for(r in t)!e&&!X.call(t,r)||c&&("length"==r||(o=r,!!(i=null==(i=s)?u:i)&&("number"==typeof o||l.test(o))&&-1<o&&o%1==0&&o<i))||a.push(r);return a}function gt(t,e,n){var r=t[e];X.call(t,e)&&Ot(r,n)&&(void 0!==n||e in t)||(t[e]=n)}function mt(t,e){for(var n=t.length;n--;)if(Ot(t[n][0],e))return n;return-1}function vt(n,r,o,i,t,e,a){var s;if(i&&(s=e?i(n,t,e,a):i(n)),void 0!==s)return s;if(!Nt(n))return n;var c,u=St(n);if(u){if(s=function(t){var e=t.length,n=t.constructor(e);e&&"string"==typeof t[0]&&X.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(n),!r)return function(t,e){var n=-1,r=t.length;e=e||Array(r);for(;++n<r;)e[n]=t[n];return e}(n,s)}else{var l=It(n),p=l==g||l==m;if(Et(n))return function(t,e){if(e)return t.slice();e=new t.constructor(t.length);return t.copy(e),e}(n,r);if(l==w||l==d||p&&!e){if(q(n))return e?n:{};if(s="function"!=typeof(c=p?{}:n).constructor||At(c)?{}:function(t){return Nt(t)?Y(t):{}}(Q(c)),!r)return p=t=n,c=(c=s)&&jt(p,zt(p),c),jt(t,kt(t),c)}else{if(!L[l])return e?n:{};s=function(t,e,n,r){var o=t.constructor;switch(e){case I:return wt(t);case h:case y:return new o(+t);case A:return function(t,e){e=e?wt(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.byteLength)}(t,r);case C:case O:case S:case T:case E:case D:case N:case z:case M:return function(t,e){e=e?wt(t.buffer):t.buffer;return new t.constructor(e,t.byteOffset,t.length)}(t,r);case v:return function(t,e,n){return R(e?n(B(t),!0):B(t),U,new t.constructor)}(t,r,n);case b:case _:return new o(t);case j:return function(t){var e=new t.constructor(t.source,P.exec(t));return e.lastIndex=t.lastIndex,e}(t);case x:return function(t,e,n){return R(e?n($(t),!0):$(t),F,new t.constructor)}(t,r,n);case k:return function(t){return lt?Object(lt.call(t)):{}}(t)}}(n,l,vt,r)}}var f,l=(a=a||new ht).get(n);return l||(a.set(n,s),u||(f=o?function(t,e,n){e=e(t);return St(t)?e:function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}(e,n(t))}(n,zt,kt):zt(n)),function(t,e){for(var n=-1,r=t?t.length:0;++n<r&&!1!==e(t[n],n,t););}(f||n,function(t,e){f&&(t=n[e=t]),gt(s,e,vt(t,r,o,i,e,n,a))}),s)}function bt(t){var e;return Nt(t)&&(e=t,!(V&&V in e))&&(Dt(t)||q(t)?G:i).test(Ct(t))}function wt(t){var e=new t.constructor(t.byteLength);return new K(e).set(new K(t)),e}function jt(t,e,n,r){n=n||{};for(var o=-1,i=e.length;++o<i;){var a=e[o],s=r?r(n[a],t[a],a,n,t):void 0;gt(n,a,void 0===s?t[a]:s)}return n}function xt(t,e){var n,r=t.__data__;return("string"==(t=typeof(n=e))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function _t(t,e){e=e,e=null==(t=t)?void 0:t[e];return bt(e)?e:void 0}pt.prototype.clear=function(){this.__data__=ot?ot(null):{}},pt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},pt.prototype.get=function(t){var e=this.__data__;if(ot){var n=e[t];return n===r?void 0:n}return X.call(e,t)?e[t]:void 0},pt.prototype.has=function(t){var e=this.__data__;return ot?void 0!==e[t]:X.call(e,t)},pt.prototype.set=function(t,e){return this.__data__[t]=ot&&void 0===e?r:e,this},ft.prototype.clear=function(){this.__data__=[]},ft.prototype.delete=function(t){var e=this.__data__;return!((t=mt(e,t))<0)&&(t==e.length-1?e.pop():et.call(e,t,1),!0)},ft.prototype.get=function(t){var e=this.__data__;return(t=mt(e,t))<0?void 0:e[t][1]},ft.prototype.has=function(t){return-1<mt(this.__data__,t)},ft.prototype.set=function(t,e){var n=this.__data__,r=mt(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},dt.prototype.clear=function(){this.__data__={hash:new pt,map:new(rt||ft),string:new pt}},dt.prototype.delete=function(t){return xt(this,t).delete(t)},dt.prototype.get=function(t){return xt(this,t).get(t)},dt.prototype.has=function(t){return xt(this,t).has(t)},dt.prototype.set=function(t,e){return xt(this,t).set(t,e),this},ht.prototype.clear=function(){this.__data__=new ft},ht.prototype.delete=function(t){return this.__data__.delete(t)},ht.prototype.get=function(t){return this.__data__.get(t)},ht.prototype.has=function(t){return this.__data__.has(t)},ht.prototype.set=function(t,e){var n=this.__data__;if(n instanceof ft){var r=n.__data__;if(!rt||r.length<199)return r.push([t,e]),this;n=this.__data__=new dt(r)}return n.set(t,e),this};var kt=c?f(c,Object):function(){return[]},It=function(t){return W.call(t)};function At(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Z)}function Ct(t){if(null!=t){try{return H.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ot(t,e){return t===e||t!=t&&e!=e}(p&&It(new p(new ArrayBuffer(1)))!=A||rt&&It(new rt)!=v||J&&It(J.resolve())!=n||s&&It(new s)!=x||a&&It(new a)!=o)&&(It=function(t){var e=W.call(t),t=e==w?t.constructor:void 0,t=t?Ct(t):void 0;if(t)switch(t){case it:return A;case at:return v;case st:return n;case ct:return x;case ut:return o}return e});var St=Array.isArray;function Tt(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=u)&&!Dt(t);var e}var Et=t||function(){return!1};function Dt(t){t=Nt(t)?W.call(t):"";return t==g||t==m}function Nt(t){var e=typeof t;return t&&("object"==e||"function"==e)}function zt(t){return(Tt(t)?yt:function(t){if(!At(t))return nt(t);var e,n=[];for(e in Object(t))X.call(t,e)&&"constructor"!=e&&n.push(e);return n})(t)}Pt.exports=function(t){return vt(t,!0,!0)}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],71:[function(t,e,n){var r=36e5,o=864e5;function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}e.exports=function(t,e){e=e||{};var n=typeof t;if("string"==n&&0<t.length)return function(t){if(100<(t=String(t)).length)return;t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!t)return;var e=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"days":case"day":case"d":return e*o;case"hours":case"hour":case"hrs":case"hr":case"h":return e*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}(t);if("number"==n&&!1===isNaN(t))return e.long?i(e=t,o,"day")||i(e,r,"hour")||i(e,6e4,"minute")||i(e,1e3,"second")||e+" ms":function(t){if(o<=t)return Math.round(t/o)+"d";if(r<=t)return Math.round(t/r)+"h";if(6e4<=t)return Math.round(t/6e4)+"m";if(1e3<=t)return Math.round(t/1e3)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},{}],72:[function(t,e,n){"use strict";var r=t("is"),o=t("@segment/isodate"),i=t("./milliseconds"),a=t("./seconds");e.exports=function(t){return r.date(t)?t:r.number(t)?new Date((e=t)<315576e5?1e3*e:e):o.is(t)?o.parse(t):i.is(t)?i.parse(t):a.is(t)?a.parse(t):new Date(t);var e}},{"./milliseconds":73,"./seconds":74,"@segment/isodate":75,is:66}],73:[function(t,e,n){"use strict";var r=/\d{13}/;n.is=function(t){return r.test(t)},n.parse=function(t){return t=parseInt(t,10),new Date(t)}},{}],74:[function(t,e,n){"use strict";var r=/\d{10}/;n.is=function(t){return r.test(t)},n.parse=function(t){t=1e3*parseInt(t,10);return new Date(t)}},{}],75:[function(t,e,n){"use strict";var a=/^(\d{4})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:([ T])(\d{2}):?(\d{2})(?::?(\d{2})(?:[,\.](\d{1,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?)?)?$/;n.parse=function(t){var e=[1,5,6,7,11,12],n=a.exec(t),r=0;if(!n)return new Date(t);for(var o,i=0;o=e[i];i++)n[o]=parseInt(n[o],10)||0;n[2]=parseInt(n[2],10)||1,n[3]=parseInt(n[3],10)||1,n[2]--,n[8]=n[8]?(n[8]+"00").substring(0,3):0," "===n[4]?r=(new Date).getTimezoneOffset():"Z"!==n[9]&&n[10]&&(r=60*n[11]+n[12],"+"===n[10]&&(r=0-r));r=Date.UTC(n[1],n[2],n[3],n[5],n[6]+r,n[7],n[8]);return new Date(r)},n.is=function(t,e){return(!e||!1!==/^\d{4}-\d{2}-\d{2}/.test(t))&&a.test(t)}},{}],76:[function(t,r,e){(function(e,n){(function(){"use strict";var o=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t},t=function(t){var e,n=document.createTextNode(""),r=0;return new t(function(){var t;e&&(t=e,e=null,"function"!=typeof t?t.forEach(function(t){t()}):t())}).observe(n,{characterData:!0}),function(t){o(t),e?"function"==typeof e?e=[e,t]:e.push(t):(e=t,n.data=r=++r%2)}};r.exports=function(){if(void 0!==e&&e&&"function"==typeof e.nextTick)return e.nextTick;if("object"==typeof document&&document){if("function"==typeof MutationObserver)return t(MutationObserver);if("function"==typeof WebKitMutationObserver)return t(WebKitMutationObserver)}return"function"==typeof n?function(t){n(o(t))}:"function"==typeof setTimeout?function(t){setTimeout(o(t),0)}:null}()}).call(this)}).call(this,t("_process"),t("timers").setImmediate)},{_process:78,timers:94}],77:[function(t,e,n){function o(a){return function(e,n,t,r){var o;normalize=r&&"function"==typeof r.normalizer?r.normalizer:s,n=normalize(n);for(var i=!1;!i;)!function(){for(o in e){var t=normalize(o);if(0===n.indexOf(t)){t=n.substr(t.length);if("."===t.charAt(0)||0===t.length){n=t.substr(1);t=e[o];return null==t?i=!0:n.length?e=t:i=!0}}}o=void 0,i=!0}();if(o)return null==e?e:a(e,o,t)}}function r(t,e){return t.hasOwnProperty(e)&&delete t[e],t}function i(t,e,n){return t.hasOwnProperty(e)&&(t[e]=n),t}function s(t){return t.replace(/[^a-zA-Z0-9\.]+/g,"").toLowerCase()}e.exports=o(function(t,e){if(t.hasOwnProperty(e))return t[e]}),e.exports.find=e.exports,e.exports.replace=function(t,e,n,r){return o(i).call(this,t,e,n,r),t},e.exports.del=function(t,e,n){return o(r).call(this,t,e,null,n),t}},{}],78:[function(t,e,n){var r,o,e=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(t){r=i}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(t){o=a}}();var c,u=[],l=!1,p=-1;function f(){l&&c&&(l=!1,c.length?u=c.concat(u):p=-1,u.length&&d())}function d(){if(!l){var t=s(f);l=!0;for(var e=u.length;e;){for(c=u,u=[];++p<e;)c&&c[p].run();p=-1,e=u.length}c=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function y(){}e.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new h(t,e)),1!==u.length||l||s(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=y,e.addListener=y,e.once=y,e.off=y,e.removeListener=y,e.removeAllListeners=y,e.emit=y,e.prependListener=y,e.prependOnceListener=y,e.listeners=function(t){return[]},e.binding=function(t){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(t){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],79:[function(t,e,n){e.exports=function(t,e){return t.addEventListener?(i=e,(o=t).addEventListener("load",function(t,e){i(null,e)},!1),void o.addEventListener("error",function(t){var e=new Error('script error "'+o.src+'"');e.event=t,i(e)},!1)):(r=e,(n=t).attachEvent("onreadystatechange",function(t){/complete|loaded/.test(n.readyState)&&r(null,t)}),void n.attachEvent("onerror",function(t){var e=new Error('failed to load the script "'+n.src+'"');e.event=t||window.event,r(e)}));var n,r,o,i}},{}],80:[function(t,e,n){"use strict";var o=t("obj-case");e.exports=function(t){function e(n,r){return function(){var t=this.traits(),e=this.properties?this.properties():{};return o(t,"address."+n)||o(t,n)||(r?o(t,"address."+r):null)||(r?o(t,r):null)||o(e,"address."+n)||o(e,n)||(r?o(e,"address."+r):null)||(r?o(e,r):null)}}t.zip=e("postalCode","zip"),t.country=e("country"),t.street=e("street"),t.state=e("state"),t.city=e("city"),t.region=e("region")}},{"obj-case":77}],81:[function(t,e,n){"use strict";var r=t("./utils").inherit,o=t("./facade");function i(t,e){o.call(this,t,e)}r(i,o),i.prototype.type=i.prototype.action=function(){return"alias"},i.prototype.from=i.prototype.previousId=function(){return this.field("previousId")||this.field("from")},i.prototype.to=i.prototype.userId=function(){return this.field("userId")||this.field("to")},e.exports=i},{"./facade":83,"./utils":91}],82:[function(t,e,n){"use strict";var r=t("./utils").inherit,o=t("./facade");function i(t,e){o.call(this,t,e)}r(i,o),i.prototype.type=function(){return"delete"},e.exports=i},{"./facade":83,"./utils":91}],83:[function(t,e,n){"use strict";var r=t("./address"),o=t("./utils").clone,i=t("./is-enabled"),a=t("new-date"),s=t("obj-case"),c=t("@segment/isodate-traverse"),u=t("./utils").type;function l(t,e){"clone"in(e=e||{})||(e.clone=!0),e.clone&&(t=o(t)),"traverse"in e||(e.traverse=!0),"timestamp"in t?t.timestamp=a(t.timestamp):t.timestamp=new Date,e.traverse&&c(t),this.opts=e,this.obj=t}function p(t){return o(t)}l.prototype.proxy=function(t){var e=t.split("."),t=this[t=e.shift()]||this.field(t);return t&&("function"==typeof t&&(t=t.call(this)||{}),0===e.length||(t=s(t,e.join("."))),this.opts.clone?p(t):t)},l.prototype.field=function(t){t=this.obj[t];return this.opts.clone?p(t):t},l.proxy=function(t){return function(){return this.proxy(t)}},l.field=function(t){return function(){return this.field(t)}},l.multi=function(e){return function(){var t=this.proxy(e+"s");if("array"===u(t))return t;t=this.proxy(e);return(t=t&&[this.opts.clone?o(t):t])||[]}},l.one=function(e){return function(){var t=this.proxy(e);if(t)return t;t=this.proxy(e+"s");return"array"===u(t)?t[0]:void 0}},l.prototype.json=function(){var t=this.opts.clone?o(this.obj):this.obj;return this.type&&(t.type=this.type()),t},l.prototype.context=l.prototype.options=function(t){var e=this.obj.options||this.obj.context||{},e=this.opts.clone?o(e):e;if(!t)return e;if(this.enabled(t)){e=this.integrations(),e=e[t]||s(e,t);return"object"!=typeof e&&(e=s(this.options(),t)),"object"==typeof e?e:{}}},l.prototype.enabled=function(t){var e=this.proxy("options.providers.all");"boolean"!=typeof e&&(e=this.proxy("options.all")),"boolean"!=typeof e&&(e=this.proxy("integrations.all")),"boolean"!=typeof e&&(e=!0);var n=e&&i(t),e=this.integrations();return e.providers&&e.providers.hasOwnProperty(t)&&(n=e.providers[t]),e.hasOwnProperty(t)&&(n="boolean"!=typeof(t=e[t])||t),!!n},l.prototype.integrations=function(){return this.obj.integrations||this.proxy("options.providers")||this.options()},l.prototype.active=function(){var t=this.proxy("options.active");return null==t&&(t=!0),t},l.prototype.sessionId=l.prototype.anonymousId=function(){return this.field("anonymousId")||this.field("sessionId")},l.prototype.groupId=l.proxy("options.groupId"),l.prototype.traits=function(t){var e,n=this.proxy("options.traits")||{},r=this.userId();for(e in t=t||{},r&&(n.id=r),t){var o=null==this[e]?this.proxy("options.traits."+e):this[e]();null!=o&&(n[t[e]]=o,delete n[e])}return n},l.prototype.library=function(){var t=this.proxy("options.library");return t?"string"==typeof t?{name:t,version:null}:t:{name:"unknown",version:null}},l.prototype.device=function(){var t=this.proxy("context.device");"object"!==u(t)&&(t={});var e=this.library().name;return t.type||(-1<e.indexOf("ios")&&(t.type="ios"),-1<e.indexOf("android")&&(t.type="android")),t},l.prototype.userAgent=l.proxy("context.userAgent"),l.prototype.timezone=l.proxy("context.timezone"),l.prototype.timestamp=l.field("timestamp"),l.prototype.channel=l.field("channel"),l.prototype.ip=l.proxy("context.ip"),l.prototype.userId=l.field("userId"),r(l.prototype),e.exports=l},{"./address":80,"./is-enabled":87,"./utils":91,"@segment/isodate-traverse":36,"new-date":72,"obj-case":77}],84:[function(t,e,n){"use strict";var r=t("./utils").inherit,o=t("is-email"),i=t("new-date"),a=t("./facade");function s(t,e){a.call(this,t,e)}r(s,a),s.prototype.type=s.prototype.action=function(){return"group"},s.prototype.groupId=a.field("groupId"),s.prototype.created=function(){var t=this.proxy("traits.createdAt")||this.proxy("traits.created")||this.proxy("properties.createdAt")||this.proxy("properties.created");if(t)return i(t)},s.prototype.email=function(){var t=this.proxy("traits.email");if(t)return t;t=this.groupId();return o(t)?t:void 0},s.prototype.traits=function(t){var e,n=this.properties(),r=this.groupId();for(e in t=t||{},r&&(n.id=r),t){var o=null==this[e]?this.proxy("traits."+e):this[e]();null!=o&&(n[t[e]]=o,delete n[e])}return n},s.prototype.name=a.proxy("traits.name"),s.prototype.industry=a.proxy("traits.industry"),s.prototype.employees=a.proxy("traits.employees"),s.prototype.properties=function(){return this.field("traits")||this.field("properties")||{}},e.exports=s},{"./facade":83,"./utils":91,"is-email":65,"new-date":72}],85:[function(t,e,n){"use strict";var r=t("./facade"),o=t("obj-case"),i=t("./utils").inherit,a=t("is-email"),s=t("new-date"),c=t("trim"),u=t("./utils").type;function l(t,e){r.call(this,t,e)}i(l,r),l.prototype.type=l.prototype.action=function(){return"identify"},l.prototype.traits=function(t){var e,n=this.field("traits")||{},r=this.userId();for(e in t=t||{},r&&(n.id=r),t){var o=null==this[e]?this.proxy("traits."+e):this[e]();null!=o&&(n[t[e]]=o,e!==t[e]&&delete n[e])}return n},l.prototype.email=function(){var t=this.proxy("traits.email");if(t)return t;t=this.userId();return a(t)?t:void 0},l.prototype.created=function(){var t=this.proxy("traits.created")||this.proxy("traits.createdAt");if(t)return s(t)},l.prototype.companyCreated=function(){var t=this.proxy("traits.company.created")||this.proxy("traits.company.createdAt");if(t)return s(t)},l.prototype.companyName=function(){return this.proxy("traits.company.name")},l.prototype.name=function(){var t=this.proxy("traits.name");if("string"==typeof t)return c(t);var e=this.firstName(),t=this.lastName();return e&&t?c(e+" "+t):void 0},l.prototype.firstName=function(){var t=this.proxy("traits.firstName");if("string"==typeof t)return c(t);t=this.proxy("traits.name");return"string"==typeof t?c(t).split(" ")[0]:void 0},l.prototype.lastName=function(){var t=this.proxy("traits.lastName");if("string"==typeof t)return c(t);var e=this.proxy("traits.name");if("string"==typeof e){t=c(e).indexOf(" ");if(-1!==t)return c(e.substr(t+1))}},l.prototype.uid=function(){return this.userId()||this.username()||this.email()},l.prototype.description=function(){return this.proxy("traits.description")||this.proxy("traits.background")},l.prototype.age=function(){var t=this.birthday(),e=o(this.traits(),"age");return null!=e?e:"date"===u(t)?(new Date).getFullYear()-t.getFullYear():void 0},l.prototype.avatar=function(){var t=this.traits();return o(t,"avatar")||o(t,"photoUrl")||o(t,"avatarUrl")},l.prototype.position=function(){var t=this.traits();return o(t,"position")||o(t,"jobTitle")},l.prototype.username=r.proxy("traits.username"),l.prototype.website=r.one("traits.website"),l.prototype.websites=r.multi("traits.website"),l.prototype.phone=r.one("traits.phone"),l.prototype.phones=r.multi("traits.phone"),l.prototype.address=r.proxy("traits.address"),l.prototype.gender=r.proxy("traits.gender"),l.prototype.birthday=r.proxy("traits.birthday"),e.exports=l},{"./facade":83,"./utils":91,"is-email":65,"new-date":72,"obj-case":77,trim:97}],86:[function(t,e,n){"use strict";var r=t("./facade");r.Alias=t("./alias"),r.Group=t("./group"),r.Identify=t("./identify"),r.Track=t("./track"),r.Page=t("./page"),r.Screen=t("./screen"),r.Delete=t("./delete"),e.exports=r},{"./alias":81,"./delete":82,"./facade":83,"./group":84,"./identify":85,"./page":88,"./screen":89,"./track":90}],87:[function(t,e,n){"use strict";var r={Salesforce:!0};e.exports=function(t){return!r[t]}},{}],88:[function(t,e,n){"use strict";var r=t("./utils").inherit,o=t("./facade"),i=t("./track"),a=t("is-email");function s(t,e){o.call(this,t,e)}r(s,o),s.prototype.type=s.prototype.action=function(){return"page"},s.prototype.category=o.field("category"),s.prototype.name=o.field("name"),s.prototype.title=o.proxy("properties.title"),s.prototype.path=o.proxy("properties.path"),s.prototype.url=o.proxy("properties.url"),s.prototype.referrer=function(){return this.proxy("context.referrer.url")||this.proxy("context.page.referrer")||this.proxy("properties.referrer")},s.prototype.properties=function(t){var e,n=this.field("properties")||{},r=this.category(),o=this.name();for(e in t=t||{},r&&(n.category=r),o&&(n.name=o),t){var i=null==this[e]?this.proxy("properties."+e):this[e]();null!=i&&(n[t[e]]=i,e!==t[e]&&delete n[e])}return n},s.prototype.email=function(){var t=this.proxy("context.traits.email")||this.proxy("properties.email");if(t)return t;t=this.userId();return a(t)?t:void 0},s.prototype.fullName=function(){var t=this.category(),e=this.name();return e&&t?t+" "+e:e},s.prototype.event=function(t){return t?"Viewed "+t+" Page":"Loaded a Page"},s.prototype.track=function(t){var e=this.json();return e.event=this.event(t),e.timestamp=this.timestamp(),e.properties=this.properties(),new i(e,this.opts)},e.exports=s},{"./facade":83,"./track":90,"./utils":91,"is-email":65}],89:[function(t,e,n){"use strict";var r=t("./utils").inherit,o=t("./page"),i=t("./track");function a(t,e){o.call(this,t,e)}r(a,o),a.prototype.type=a.prototype.action=function(){return"screen"},a.prototype.event=function(t){return t?"Viewed "+t+" Screen":"Loaded a Screen"},a.prototype.track=function(t){var e=this.json();return e.event=this.event(t),e.timestamp=this.timestamp(),e.properties=this.properties(),new i(e,this.opts)},e.exports=a},{"./page":88,"./track":90,"./utils":91}],90:[function(t,e,n){"use strict";var r=t("./utils").inherit,o=t("./utils").type,i=t("./facade"),a=t("./identify"),s=t("is-email"),c=t("obj-case");function u(t,e){i.call(this,t,e)}r(u,i),u.prototype.type=u.prototype.action=function(){return"track"},u.prototype.event=i.field("event"),u.prototype.value=i.proxy("properties.value"),u.prototype.category=i.proxy("properties.category"),u.prototype.id=i.proxy("properties.id"),u.prototype.productId=function(){return this.proxy("properties.product_id")||this.proxy("properties.productId")},u.prototype.promotionId=function(){return this.proxy("properties.promotion_id")||this.proxy("properties.promotionId")},u.prototype.cartId=function(){return this.proxy("properties.cart_id")||this.proxy("properties.cartId")},u.prototype.checkoutId=function(){return this.proxy("properties.checkout_id")||this.proxy("properties.checkoutId")},u.prototype.paymentId=function(){return this.proxy("properties.payment_id")||this.proxy("properties.paymentId")},u.prototype.couponId=function(){return this.proxy("properties.coupon_id")||this.proxy("properties.couponId")},u.prototype.wishlistId=function(){return this.proxy("properties.wishlist_id")||this.proxy("properties.wishlistId")},u.prototype.reviewId=function(){return this.proxy("properties.review_id")||this.proxy("properties.reviewId")},u.prototype.orderId=function(){return this.proxy("properties.id")||this.proxy("properties.order_id")||this.proxy("properties.orderId")},u.prototype.sku=i.proxy("properties.sku"),u.prototype.tax=i.proxy("properties.tax"),u.prototype.name=i.proxy("properties.name"),u.prototype.price=i.proxy("properties.price"),u.prototype.total=i.proxy("properties.total"),u.prototype.repeat=i.proxy("properties.repeat"),u.prototype.coupon=i.proxy("properties.coupon"),u.prototype.shipping=i.proxy("properties.shipping"),u.prototype.discount=i.proxy("properties.discount"),u.prototype.shippingMethod=function(){return this.proxy("properties.shipping_method")||this.proxy("properties.shippingMethod")},u.prototype.paymentMethod=function(){return this.proxy("properties.payment_method")||this.proxy("properties.paymentMethod")},u.prototype.description=i.proxy("properties.description"),u.prototype.plan=i.proxy("properties.plan"),u.prototype.subtotal=function(){var t=c(this.properties(),"subtotal"),e=this.total()||this.revenue();return t||(e?(this.total()&&((t=this.tax())&&(e-=t),(t=this.shipping())&&(e-=t),(t=this.discount())&&(e+=t)),e):0)},u.prototype.products=function(){var t=this.properties(),t=c(t,"products");return"array"===o(t)?t:[]},u.prototype.quantity=function(){return(this.obj.properties||{}).quantity||1},u.prototype.currency=function(){return(this.obj.properties||{}).currency||"USD"},u.prototype.referrer=function(){return this.proxy("context.referrer.url")||this.proxy("context.page.referrer")||this.proxy("properties.referrer")},u.prototype.query=i.proxy("options.query"),u.prototype.properties=function(t){var e,n=this.field("properties")||{};for(e in t=t||{}){var r=null==this[e]?this.proxy("properties."+e):this[e]();null!=r&&(n[t[e]]=r,delete n[e])}return n},u.prototype.username=function(){return this.proxy("traits.username")||this.proxy("properties.username")||this.userId()||this.sessionId()},u.prototype.email=function(){var t=this.proxy("traits.email")||this.proxy("properties.email")||this.proxy("options.traits.email");if(t)return t;t=this.userId();return s(t)?t:void 0},u.prototype.revenue=function(){var t=this.proxy("properties.revenue"),e=this.event();return!t&&e&&e.match(/^[ _]?completed[ _]?order[ _]?|^[ _]?order[ _]?completed[ _]?$/i)&&(t=this.proxy("properties.total")),function(t){if(!t)return;if("number"==typeof t)return t;if("string"!=typeof t)return;if(t=t.replace(/\$/g,""),t=parseFloat(t),!isNaN(t))return t}(t)},u.prototype.cents=function(){var t=this.revenue();return"number"!=typeof t?this.value()||0:100*t},u.prototype.identify=function(){var t=this.json();return t.traits=this.traits(),new a(t,this.opts)},e.exports=u},{"./facade":83,"./identify":85,"./utils":91,"is-email":65,"obj-case":77}],91:[function(t,e,n){"use strict";n.inherit=t("inherits"),n.clone=t("@ndhoule/clone"),n.type=t("type-component")},{"@ndhoule/clone":3,inherits:64,"type-component":98}],92:[function(t,e,n){e.exports=function(t,e){return e=e||{},t.toLowerCase().replace(e.replace||/[^a-z0-9]/g," ").replace(/^ +| +$/g,"").replace(/ +/g,e.separator||"-")}},{}],93:[function(t,n,r){!function(t){if("object"==typeof r)n.exports=t();else{var e;try{e=window}catch(t){e=self}e.SparkMD5=t()}}(function(o){"use strict";var a=function(t,e){return t+e&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function s(t,e,n,r,o,i){return e=a(a(e,t),a(r,i)),a(e<<o|e>>>32-o,n)}function c(t,e,n,r,o,i,a){return s(e&n|~e&r,t,e,o,i,a)}function u(t,e,n,r,o,i,a){return s(e&r|n&~r,t,e,o,i,a)}function l(t,e,n,r,o,i,a){return s(e^n^r,t,e,o,i,a)}function p(t,e,n,r,o,i,a){return s(n^(e|~r),t,e,o,i,a)}function f(t,e){var n=c(n=t[0],i=t[1],o=t[2],r=t[3],e[0],7,-680876936),r=c(r,n,i,o,e[1],12,-389564586),o=c(o,r,n,i,e[2],17,606105819),i=c(i,o,r,n,e[3],22,-1044525330);n=c(n,i,o,r,e[4],7,-176418897),r=c(r,n,i,o,e[5],12,1200080426),o=c(o,r,n,i,e[6],17,-1473231341),i=c(i,o,r,n,e[7],22,-45705983),n=c(n,i,o,r,e[8],7,1770035416),r=c(r,n,i,o,e[9],12,-1958414417),o=c(o,r,n,i,e[10],17,-42063),i=c(i,o,r,n,e[11],22,-1990404162),n=c(n,i,o,r,e[12],7,1804603682),r=c(r,n,i,o,e[13],12,-40341101),o=c(o,r,n,i,e[14],17,-1502002290),n=u(n,i=c(i,o,r,n,e[15],22,1236535329),o,r,e[1],5,-165796510),r=u(r,n,i,o,e[6],9,-1069501632),o=u(o,r,n,i,e[11],14,643717713),i=u(i,o,r,n,e[0],20,-373897302),n=u(n,i,o,r,e[5],5,-701558691),r=u(r,n,i,o,e[10],9,38016083),o=u(o,r,n,i,e[15],14,-660478335),i=u(i,o,r,n,e[4],20,-405537848),n=u(n,i,o,r,e[9],5,568446438),r=u(r,n,i,o,e[14],9,-1019803690),o=u(o,r,n,i,e[3],14,-187363961),i=u(i,o,r,n,e[8],20,1163531501),n=u(n,i,o,r,e[13],5,-1444681467),r=u(r,n,i,o,e[2],9,-51403784),o=u(o,r,n,i,e[7],14,1735328473),n=l(n,i=u(i,o,r,n,e[12],20,-1926607734),o,r,e[5],4,-378558),r=l(r,n,i,o,e[8],11,-2022574463),o=l(o,r,n,i,e[11],16,1839030562),i=l(i,o,r,n,e[14],23,-35309556),n=l(n,i,o,r,e[1],4,-1530992060),r=l(r,n,i,o,e[4],11,1272893353),o=l(o,r,n,i,e[7],16,-155497632),i=l(i,o,r,n,e[10],23,-1094730640),n=l(n,i,o,r,e[13],4,681279174),r=l(r,n,i,o,e[0],11,-358537222),o=l(o,r,n,i,e[3],16,-722521979),i=l(i,o,r,n,e[6],23,76029189),n=l(n,i,o,r,e[9],4,-640364487),r=l(r,n,i,o,e[12],11,-421815835),o=l(o,r,n,i,e[15],16,530742520),n=p(n,i=l(i,o,r,n,e[2],23,-995338651),o,r,e[0],6,-198630844),r=p(r,n,i,o,e[7],10,1126891415),o=p(o,r,n,i,e[14],15,-1416354905),i=p(i,o,r,n,e[5],21,-57434055),n=p(n,i,o,r,e[12],6,1700485571),r=p(r,n,i,o,e[3],10,-1894986606),o=p(o,r,n,i,e[10],15,-1051523),i=p(i,o,r,n,e[1],21,-2054922799),n=p(n,i,o,r,e[8],6,1873313359),r=p(r,n,i,o,e[15],10,-30611744),o=p(o,r,n,i,e[6],15,-1560198380),i=p(i,o,r,n,e[13],21,1309151649),n=p(n,i,o,r,e[4],6,-145523070),r=p(r,n,i,o,e[11],10,-1120210379),o=p(o,r,n,i,e[2],15,718787259),i=p(i,o,r,n,e[9],21,-343485551),t[0]=a(n,t[0]),t[1]=a(i,t[1]),t[2]=a(o,t[2]),t[3]=a(r,t[3])}function d(t){for(var e=[],n=0;n<64;n+=4)e[n>>2]=t.charCodeAt(n)+(t.charCodeAt(n+1)<<8)+(t.charCodeAt(n+2)<<16)+(t.charCodeAt(n+3)<<24);return e}function h(t){for(var e=[],n=0;n<64;n+=4)e[n>>2]=t[n]+(t[n+1]<<8)+(t[n+2]<<16)+(t[n+3]<<24);return e}function n(t){for(var e,n,r,o,i=t.length,a=[1732584193,-271733879,-1732584194,271733878],s=64;s<=i;s+=64)f(a,d(t.substring(s-64,s)));for(e=(t=t.substring(s-64)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<e;s+=1)n[s>>2]|=t.charCodeAt(s)<<(s%4<<3);if(n[s>>2]|=128<<(s%4<<3),55<s)for(f(a,n),s=0;s<16;s+=1)n[s]=0;return o=(o=8*i).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(o[2],16),o=parseInt(o[1],16)||0,n[14]=r,n[15]=o,f(a,n),a}function y(t){for(var e=0;e<t.length;e+=1)t[e]=function(t){for(var e="",n=0;n<4;n+=1)e+=r[t>>8*n+4&15]+r[t>>8*n&15];return e}(t[e]);return t.join("")}function i(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}function g(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function m(t){for(var e=[],n=t.length,r=0;r<n-1;r+=2)e.push(parseInt(t.substr(r,2),16));return String.fromCharCode.apply(String,e)}function v(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==y(n("hello"))&&(a=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(t,e){var n=this.byteLength,r=i(t,n),t=n;return e!==o&&(t=i(e,n)),t<r?new ArrayBuffer(0):(e=t-r,n=new ArrayBuffer(e),t=new Uint8Array(n),e=new Uint8Array(this,r,e),t.set(e),n)}),v.prototype.append=function(t){return this.appendBinary(g(t)),this},v.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;for(var e=this._buff.length,n=64;n<=e;n+=64)f(this._hash,d(this._buff.substring(n-64,n)));return this._buff=this._buff.substring(n-64),this},v.prototype.end=function(t){for(var e,n=this._buff,r=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<r;i+=1)o[i>>2]|=n.charCodeAt(i)<<(i%4<<3);return this._finish(o,r),e=y(this._hash),t&&(e=m(e)),this.reset(),e},v.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},v.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},v.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},v.prototype._finish=function(t,e){var n,r=e;if(t[r>>2]|=128<<(r%4<<3),55<r)for(f(this._hash,t),r=0;r<16;r+=1)t[r]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),e=parseInt(n[2],16),n=parseInt(n[1],16)||0,t[14]=e,t[15]=n,f(this._hash,t)},v.hash=function(t,e){return v.hashBinary(g(t),e)},v.hashBinary=function(t,e){t=y(n(t));return e?m(t):t},(v.ArrayBuffer=function(){this.reset()}).prototype.append=function(t){var e,n,r,o,i,a=(n=this._buff.buffer,r=t,o=!0,(i=new Uint8Array(n.byteLength+r.byteLength)).set(new Uint8Array(n)),i.set(new Uint8Array(r),n.byteLength),o?i:i.buffer),s=a.length;for(this._length+=t.byteLength,e=64;e<=s;e+=64)f(this._hash,h(a.subarray(e-64,e)));return this._buff=e-64<s?new Uint8Array(a.buffer.slice(e-64)):new Uint8Array(0),this},v.ArrayBuffer.prototype.end=function(t){for(var e,n=this._buff,r=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<r;i+=1)o[i>>2]|=n[i]<<(i%4<<3);return this._finish(o,r),e=y(this._hash),t&&(e=m(e)),this.reset(),e},v.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.ArrayBuffer.prototype.getState=function(){var t,e=v.prototype.getState.call(this);return e.buff=(t=e.buff,String.fromCharCode.apply(null,new Uint8Array(t))),e},v.ArrayBuffer.prototype.setState=function(t){return t.buff=function(t,e){for(var n=t.length,r=new ArrayBuffer(n),o=new Uint8Array(r),i=0;i<n;i+=1)o[i]=t.charCodeAt(i);return e?o:r}(t.buff,!0),v.prototype.setState.call(this,t)},v.ArrayBuffer.prototype.destroy=v.prototype.destroy,v.ArrayBuffer.prototype._finish=v.prototype._finish,v.ArrayBuffer.hash=function(t,e){t=y(function(t){for(var e,n,r,o,i=t.length,a=[1732584193,-271733879,-1732584194,271733878],s=64;s<=i;s+=64)f(a,h(t.subarray(s-64,s)));for(e=(t=s-64<i?t.subarray(s-64):new Uint8Array(0)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<e;s+=1)n[s>>2]|=t[s]<<(s%4<<3);if(n[s>>2]|=128<<(s%4<<3),55<s)for(f(a,n),s=0;s<16;s+=1)n[s]=0;return o=(o=8*i).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(o[2],16),o=parseInt(o[1],16)||0,n[14]=r,n[15]=o,f(a,n),a}(new Uint8Array(t)));return e?m(t):t},v})},{}],94:[function(c,t,u){(function(n,s){(function(){var r=c("process/browser.js").nextTick,t=Function.prototype.apply,o=Array.prototype.slice,i={},a=0;function e(t,e){this._id=t,this._clearFn=e}u.setTimeout=function(){return new e(t.call(setTimeout,window,arguments),clearTimeout)},u.setInterval=function(){return new e(t.call(setInterval,window,arguments),clearInterval)},u.clearTimeout=u.clearInterval=function(t){t.close()},e.prototype.unref=e.prototype.ref=function(){},e.prototype.close=function(){this._clearFn.call(window,this._id)},u.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},u.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},u._unrefActive=u.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;0<=e&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},u.setImmediate="function"==typeof n?n:function(t){var e=a++,n=!(arguments.length<2)&&o.call(arguments,1);return i[e]=!0,r(function(){i[e]&&(n?t.apply(null,n):t.call(null),u.clearImmediate(e))}),e},u.clearImmediate="function"==typeof s?s:function(t){delete i[t]}}).call(this)}).call(this,c("timers").setImmediate,c("timers").clearImmediate)},{"process/browser.js":78,timers:94}],95:[function(e,t,n){var o;try{o=e("props")}catch(t){o=e("component-props")}function r(t){switch({}.toString.call(t)){case"[object Object]":return function(t){var e,n={};for(e in t)n[e]=("string"==typeof t[e]?i:r)(t[e]);return function(t){if("object"!=typeof t)return!1;for(var e in n){if(!(e in t))return!1;if(!n[e](t[e]))return!1}return!0}}(t);case"[object Function]":return t;case"[object String]":return/^ *\W+/.test(n=t)?new Function("_","return _ "+n):new Function("_","return "+function(t){var e,n,r=o(t);if(!r.length)return"_."+t;for(e=0;e<r.length;e++)n=r[e],t=function(t,e,n){return e.replace(new RegExp("(\\.)?"+t,"g"),function(t,e){return e?t:n})}(n,t,n="('function' == typeof "+(n="_."+n)+" ? "+n+"() : "+n+")");return t}(n));case"[object RegExp]":return e=t,function(t){return e.test(t)};default:return i(t)}var e,n}function i(e){return function(t){return e===t}}t.exports=r},{"component-props":54,props:54}],96:[function(t,e,n){e.exports=function(t){return(r.test(t)?t:o.test(t)?function(t){return t.replace(i,function(t,e){return e?" "+e:""})}(t)||t:function(t){return t.replace(a,function(t,e,n){return e+" "+n.toLowerCase().split("").join(" ")})}(t)).toLowerCase()};var r=/\s/,o=/[\W_]/;var i=/[\W_]+(.|$)/g;var a=/(.)([A-Z]+)/g},{}],97:[function(t,e,n){(n=e.exports=function(t){return t.replace(/^\s*|\s*$/g,"")}).left=function(t){return t.replace(/^\s*/,"")},n.right=function(t){return t.replace(/\s*$/,"")}},{}],98:[function(t,e,n){var r=Object.prototype.toString;e.exports=function(t){switch(r.call(t)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array"}return null===t?"null":void 0===t?"undefined":t===Object(t)?"object":typeof t}},{}],99:[function(t,e,n){e.exports=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e+=String.fromCharCode(r):(127<r&&r<2048?e+=String.fromCharCode(r>>6|192):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128)),e+=String.fromCharCode(63&r|128))}return e}},{}],100:[function(t,i,e){(function(o){(function(){var t,e,n,r=o.crypto||o.msCrypto;r&&r.getRandomValues&&(t=new Uint8Array(16),e=function(){return r.getRandomValues(t),t}),e||(n=new Array(16),e=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}),i.exports=e}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],101:[function(t,e,n){for(var a=t("./rng"),r=[],i={},o=0;o<256;o++)r[o]=(o+256).toString(16).substr(1),i[r[o]]=o;function l(t,e){e=e||0;return r[t[e++]]+r[t[e++]]+r[t[e++]]+r[t[e++]]+"-"+r[t[e++]]+r[t[e++]]+"-"+r[t[e++]]+r[t[e++]]+"-"+r[t[e++]]+r[t[e++]]+"-"+r[t[e++]]+r[t[e++]]+r[t[e++]]+r[t[e++]]+r[t[e++]]+r[t[e++]]}var t=a(),p=[1|t[0],t[1],t[2],t[3],t[4],t[5]],f=16383&(t[6]<<8|t[7]),d=0,h=0;function s(t,e,n){var r=e&&n||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||a)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var i=0;i<16;i++)e[r+i]=o[i];return e||l(o)}t=s;t.v1=function(t,e,n){var r=e&&n||0,o=e||[],i=void 0!==(t=t||{}).clockseq?t.clockseq:f,a=void 0!==t.msecs?t.msecs:(new Date).getTime(),s=void 0!==t.nsecs?t.nsecs:h+1;if((n=a-d+(s-h)/1e4)<0&&void 0===t.clockseq&&(i=i+1&16383),(n<0||d<a)&&void 0===t.nsecs&&(s=0),1e4<=s)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=a,f=i,s=(1e4*(268435455&(a+=122192928e5))+(h=s))%4294967296,o[r++]=s>>>24&255,o[r++]=s>>>16&255,o[r++]=s>>>8&255,o[r++]=255&s,a=a/4294967296*1e4&268435455,o[r++]=a>>>8&255,o[r++]=255&a,o[r++]=a>>>24&15|16,o[r++]=a>>>16&255,o[r++]=i>>>8|128,o[r++]=255&i;for(var c=t.node||p,u=0;u<6;u++)o[r+u]=c[u];return e||l(o)},t.v4=s,t.parse=function(t,e,n){var r=e&&n||0,o=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){o<16&&(e[r+o++]=i[t])});o<16;)e[r+o++]=0;return e},t.unparse=l,e.exports=t},{"./rng":100}],102:[function(t,e,n){e.exports={name:"unomi-analytics",version:"1.0.10",description:"The Apache Unomi analytics.js integration.",main:"dist/unomi-tracker.js",keywords:["unomi","analytics.js","apache"],author:"Apache Software Foundation",license:"Apache-2.0",scripts:{build:"yarn browserify && yarn replace && yarn minify && yarn snippet:minify",browserify:"browserify src/index.js -p [ browserify-header --file src/license.js ] -s unomiTracker -o dist/unomi-tracker.js",replace:"replace-in-file 'analytics.require = require' '//analytics.require = require' dist/unomi-tracker.js",minify:"cd dist && uglifyjs -c -m --comments '/@license/' -o unomi-tracker.min.js --source-map url=unomi-tracker.min.js.map -- unomi-tracker.js","snippet:minify":"uglifyjs -c -m -o snippet.min.js --source-map url=snipper.min.js.map -- snippet.js",clean:"rimraf *.log dist/unomi-tracker.js dist/unomi-tracker.min.js","clean:all":"yarn clean && rimraf node_modules"},dependencies:{"@segment/analytics.js-core":"3.10.1","@segment/analytics.js-integration":"3.2.1",extend:"^3.0.2"},devDependencies:{browserify:"^16.5.1","browserify-header":"^1.0.1","replace-in-file":"^3.4.2",rimraf:"^2.6.2","uglify-js":"^3.9.2",yarn:"^1.22.4"}}},{}],103:[function(n,t,e){"use strict";var r=n("@segment/analytics.js-integration"),o=n("extend"),r=t.exports=r("Apache Unomi").global("cxs").assumesPageview().readyOnLoad().option("scope","systemscope").option("url","http://localhost:8181").option("timeoutInMilliseconds",3e3).option("sessionCookieName","unomiSessionId").option("sessionId");r.prototype.initialize=function(){var t,e,r=this;console.info("[UNOMI] Initializing...",arguments),this.analytics.on("invoke",function(t){var e=t.action(),n="on"+t.action();r.debug("%s %o",e,t),r[n]&&r[n](t)}),this.analytics.personalize=function(t,e){this.emit("invoke",{action:function(){return"personalize"},personalization:t,callback:e})},navigator.cookieEnabled?(window.digitalData=window.digitalData||{scope:r.options.scope},window.digitalData.page=window.digitalData.page||{path:location.pathname+location.hash,pageInfo:{pageName:document.title,pageID:location.pathname+location.hash,pagePath:location.pathname+location.hash,destinationURL:location.href}},e=(e=window.digitalData.page)||(window.digitalData.page={pageInfo:{}}),r.options.initialPageProperties&&(t=r.options.initialPageProperties,this.fillPageData(e,t)),window.digitalData.events=window.digitalData.events||[],window.digitalData.events.push(this.buildEvent("view",this.buildPage(e),this.buildSource(this.options.scope,"site"))),r.options.sessionId?this.sessionId=r.options.sessionId:(e=n("component-cookie"),r.sessionId=e(r.options.sessionCookieName),r.sessionId&&""!==r.sessionId||(r.sessionId=r.generateGuid(),e(r.options.sessionCookieName,r.sessionId))),setTimeout(r.loadContext.bind(r),0)):this.executeFallback()},r.prototype.loaded=function(){return!!window.cxs},r.prototype.page=function(t){var e={};this.fillPageData(e,t.json().properties),this.collectEvent(this.buildEvent("view",this.buildPage(e),this.buildSource(this.options.scope,"site")))},r.prototype.fillPageData=function(t,e){t.attributes=[],t.consentTypes=[],t.interests=e.interests||{},t.pageInfo=o({},t.pageInfo,e.pageInfo),t.pageInfo.pageName=t.pageInfo.pageName||e.title,t.pageInfo.pageID=t.pageInfo.pageID||e.path,t.pageInfo.pagePath=t.pageInfo.pagePath||e.path,t.pageInfo.destinationURL=t.pageInfo.destinationURL||e.url,t.pageInfo.referringURL=t.pageInfo.referringURL||e.referrer,this.processReferrer()},r.prototype.processReferrer=function(){var t=document.referrer;if(t){var e=document.createElement("a");e.href=t;var n=document.createElement("a");if(n.href=document.URL,e.host!==n.host){t=e.search,n=void 0;if(t&&""!=t){for(var r,o=[],i=t.slice(1).split("&"),a=0;a<i.length;a++)r=i[a].split("="),o.push(r[0]),o[r[0]]=r[1];n=o.q||o.p,n=decodeURIComponent(n).replace(/\+/g," ")}window.digitalData&&window.digitalData.page&&window.digitalData.page.pageInfo&&(window.digitalData.page.pageInfo.referrerHost=e.host,window.digitalData.page.pageInfo.referrerQuery=n),this.registerEvent(this.buildEvent("viewFromReferrer",this.buildTargetPage()))}}},r.prototype.identify=function(t){this.collectEvent(this.buildEvent("identify",this.buildTarget(t.userId(),"analyticsUser",t.traits()),this.buildSource(this.options.scope,"site",t.context())))},r.prototype.track=function(t){var e,n;t.event()&&0===t.event().indexOf("form")?(e=document.forms[t.properties().formName],(n=this.buildFormEvent(e.name)).properties=this.extractFormData(e),this.collectEvent(n)):this.collectEvent(this.buildEvent(t.event(),this.buildTargetPage(),this.buildSource(this.options.scope,"site",t.context()),t.properties()))},r.prototype.loadContext=function(t,e){this.contextLoaded=!0;var n={requiredProfileProperties:["j:nodename"],source:this.buildPage(window.digitalData.page)};t||(n.events=window.digitalData.events),window.digitalData.personalizationCallback&&(n.personalizations=window.digitalData.personalizationCallback.map(function(t){return t.personalization})),n.sessionId=this.sessionId;t=this.options.url+"/context.json";e&&(t+="?invalidateSession=true&invalidateProfile=true");var r=this;this.ajax({url:t,type:"POST",async:!0,contentType:"text/plain;charset=UTF-8",jsonData:n,dataType:"application/json",invalidate:e,success:function(t){if(window.cxs=JSON.parse(t.responseText),r.ready(),window.digitalData.loadCallbacks){console.info("[UNOMI] Found context server load callbacks, calling now...");for(var e=0;e<window.digitalData.loadCallbacks.length;e++)window.digitalData.loadCallbacks[e](digitalData)}if(window.digitalData.personalizationCallback){console.info("[UNOMI] Found context server personalization, calling now...");for(e=0;e<window.digitalData.personalizationCallback.length;e++)window.digitalData.personalizationCallback[e].callback(cxs.personalizations[window.digitalData.personalizationCallback[e].personalization.id])}},error:this.executeFallback}),console.info("[UNOMI] Context loading...")},r.prototype.onpersonalize=function(t){this.contextLoaded?console.error("[UNOMI] Already loaded, too late..."):(window.digitalData=window.digitalData||{scope:this.options.scope},window.digitalData.personalizationCallback=window.digitalData.personalizationCallback||[],window.digitalData.personalizationCallback.push({personalization:t.personalization,callback:t.callback}))},r.prototype.buildEvent=function(t,e,n,r){t={eventType:t,scope:window.digitalData.scope};return e&&(t.target=e),n&&(t.source=n),r&&(t.properties=r),t},r.prototype.buildFormEvent=function(t){return this.buildEvent("form",this.buildTarget(t,"form"),this.buildSourcePage())},r.prototype.buildTargetPage=function(){return this.buildTarget(window.digitalData.page.pageInfo.pageID,"page",window.digitalData.page)},r.prototype.buildSourcePage=function(){return this.buildSource(window.digitalData.page.pageInfo.pageID,"page",window.digitalData.page)},r.prototype.buildPage=function(t){return this.buildSource(t.pageInfo.pageID,"page",t)},r.prototype.buildTarget=function(t,e,n){return this.buildObject(t,e,n)},r.prototype.buildSource=function(t,e,n){return this.buildObject(t,e,n)},r.prototype.collectEvent=function(t,e,n){this.collectEvents({events:[t]},e,n)},r.prototype.collectEvents=function(t,e,n){t.sessionId=this.sessionId;t=JSON.stringify(t);this.ajax({url:this.options.url+"/eventcollector",type:"POST",async:!0,contentType:"text/plain;charset=UTF-8",data:t,dataType:"application/json",success:e,error:n})},r.prototype.registerEvent=function(t){window.digitalData?window.cxs?console.error("[UNOMI] already loaded, too late..."):(window.digitalData.events=window.digitalData.events||[],window.digitalData.events.push(t)):(window.digitalData={},window.digitalData.events=window.digitalData.events||[],window.digitalData.events.push(t))},r.prototype.registerCallback=function(t){window.digitalData?window.cxs?(console.info("[UNOMI] digitalData object loaded, calling on load callback immediately and registering update callback..."),t&&t(window.digitalData)):(console.info("[UNOMI] digitalData object present but not loaded, registering load callback..."),t&&(window.digitalData.loadCallbacks=window.digitalData.loadCallbacks||[],window.digitalData.loadCallbacks.push(t))):(console.info("[UNOMI] No digital data object found, creating and registering update callback..."),window.digitalData={},t&&(window.digitalData.loadCallbacks=[],window.digitalData.loadCallbacks.push(t)))},r.prototype.generateGuid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},r.prototype.buildObject=function(t,e,n){e={scope:window.digitalData.scope,itemId:t,itemType:e};return n&&(e.properties=n),e},r.prototype.ajax=function(t){var e=new XMLHttpRequest;"withCredentials"in e?(e.open(t.type,t.url,t.async),e.withCredentials=!0):"undefined"!=typeof XDomainRequest&&(e=new XDomainRequest).open(t.type,t.url),t.contentType&&e.setRequestHeader("Content-Type",t.contentType),t.dataType&&e.setRequestHeader("Accept",t.dataType),t.responseType&&(e.responseType=t.responseType);var n=!1;-1!==this.options.timeoutInMilliseconds&&setTimeout(function(){n||(console.error("[UNOMI] XML request timeout, url: "+t.url),n=!0,t.error&&t.error(e))},this.options.timeoutInMilliseconds),e.onreadystatechange=function(){n||4===e.readyState&&(200===e.status||204===e.status||304===e.status?null!=e.responseText&&(n=!0,t.success&&t.success(e)):(n=!0,t.error&&t.error(e),console.error("[UNOMI] XML request error: "+e.statusText+" ("+e.status+")")))},t.jsonData?e.send(JSON.stringify(t.jsonData)):t.data?e.send(t.data):e.send()},r.prototype.executeFallback=function(){for(var t in console.warn("[UNOMI] execute fallback"),window.cxs={},window.digitalData.loadCallbacks)window.digitalData.loadCallbacks[t]();if(window.digitalData.personalizationCallback)for(var e=0;e<window.digitalData.personalizationCallback.length;e++)window.digitalData.personalizationCallback[e].callback([window.digitalData.personalizationCallback[e].personalization.strategyOptions.fallback])},r.prototype.extractFormData=function(t){for(var e={},n=0;n<t.elements.length;n++){var r=t.elements[n];if(void 0!==r.name)switch(r.nodeName){case"TEXTAREA":case"INPUT":switch(r.type){case"checkbox":1<document.querySelectorAll('input[name="'+r.name+'"]').length&&(e[r.name]||(e[r.name]=[]),r.checked&&e[r.name].push(r.value));break;case"radio":r.checked&&(e[r.name]=r.value);break;default:if(!r.value||""===r.value)break;e[r.name]=r.value}break;case"SELECT":if(r.options&&r.options[r.selectedIndex])if(r.multiple){e[r.name]=[];for(var o=0;o<r.options.length;o++)r.options[o].selected&&e[r.name].push(r.options[o].value)}else e[r.name]=r.options[r.selectedIndex].value;break;default:console.warn("[UNOMI] "+r.nodeName+" form element type not implemented and will not be tracked.")}}return e}},{"@segment/analytics.js-integration":29,"component-cookie":46,extend:62}],104:[function(t,e,n){var r,o=t("@segment/analytics.js-core"),i=t("./integrations");for(r in(e.exports=o).require=t,o.VERSION=t("../package.json").version,i)o.use(i[r])},{"../package.json":102,"./integrations":105,"@segment/analytics.js-core":19}],105:[function(t,e,n){"use strict";e.exports={"apache-unomi":t("./analytics.js-integration-apache-unomi")}},{"./analytics.js-integration-apache-unomi":103}]},{},[104])(104)});
//# sourceMappingURL=unomi-tracker.min.js.map
"""
#
#
# @application.get("/auth")
# async def auth(user: User = Depends(User.factory)):
#     return user

# @application.post("/uql")
# async def uql_query(request: Request, uql=Depends(context_server_via_uql)):
#     """
#     Send any query in plain text body.
#     """
#
#     q = await request.body()
#     q = q.decode('utf-8')
#     return query(q, uql)


# @application.post("/select")
# async def select_query(request: Request, uql=Depends(context_server_via_uql)):
#
#     try:
#         q = await request.body()
#         q = q.decode('utf-8')
#         response_tuple = uql.select(q)
#         result = uql.respond(response_tuple)
#         print(result)
#         return result
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))


# @application.post("/rule")
# async def create_query(rule: Rule, uql=Depends(context_server_via_uql)):
#     q = f"CREATE RULE \"{rule.name}\" DESCRIBE \"{rule.desc}\" IN SCOPE \"{rule.scope}\" " + \
#         f"WHEN {rule.condition} THEN {rule.action}"
#     print(q)
#     unomi_result = query(q, uql)
#
#     upserted_records, errors = upsert_rule(elastic, q, rule)
#     print(upserted_records, errors)
#
#     return unomi_result


# @application.post("/segment")
# async def create_query(segment: Segment, uql=Depends(context_server_via_uql), elastic=Depends(elastic_client)):
#     q = f"CREATE SEGMENT \"{segment.name}\" DESCRIBE \"{segment.desc}\" IN SCOPE \"{segment.scope}\" " + \
#         f"WHEN {segment.condition}"
#     unomi_result = query(q, uql)
#
#     print(unomi_result)
#
#     upserted_records, errors = upsert_segment(elastic, q, segment)
#     print(upserted_records, errors)
#
#     return unomi_result


# @application.get("/ref/context/{strategy}")
# async def ref_callbacks(strategy: str, host: Host = Depends(get_context_server_host)):
#     if strategy not in ["actions", "conditions"]:
#         raise HTTPException(status_code=404, detail="Incorrect url")
#
#     try:
#         async with httpx.AsyncClient() as client:
#             url = host.uri(f'cxs/definitions/{strategy}/')
#             context_server_response = await client.get(str(url))
#         return context_server_response.json()
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))
#
#
# @application.get("/ref/uql/{strategy}")
# async def ref_callbacks(strategy: str):
#     if strategy not in ["actions", "conditions"]:
#         raise HTTPException(status_code=404, detail="Incorrect url")
#
#     try:
#         result = []
#         for name, values in action_mapper.items():
#             action = {
#                 "name": name,
#                 "metadata": values["metadata"]
#             }
#             result.append(action)
#         return result
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))


# @application.post("/select/events")
# async def datagrid_event(request: Request, uql=Depends(context_server_via_uql)):
#     try:
#         q = await request.body()
#         q = q.decode('utf-8')
#         if q:
#             q = f"SELECT EVENT WHERE {q}"
#         else:
#             q = "SELECT EVENT LIMIT 20"
#
#         response_tuple = uql.select(q)
#         result = uql.respond(response_tuple)
#         result = list(filter_event(result))
#         print(result)
#         return result
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))


# @application.post("/select/rules")
# async def datagrid_select_rule(request: Request, uql=Depends(context_server_via_uql)):
#     try:
#         q = await request.body()
#         q = q.decode('utf-8')
#         if q:
#             q = f"SELECT RULE WHERE {q}"
#         else:
#             q = "SELECT RULE LIMIT 20"
#         response_tuple = uql.select(q)
#         result = uql.respond(response_tuple)
#         result = list(filter_rule(result))
#         print(result)
#         return result
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))


# @application.post("/select/segments")
# async def datagrid_select_segment(request: Request, uql=Depends(context_server_via_uql)):
#     try:
#         q = await request.body()
#         q = q.decode('utf-8')
#         if q:
#             q = f"SELECT SEGMENT WHERE {q}"
#         else:
#             q = "SELECT SEGMENT LIMIT 20"
#         response_tuple = uql.select(q)
#         result = uql.respond(response_tuple)
#         result = list(filter_segment(result))
#         print(result)
#         return result
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))


# @application.post("/select/profiles")
# async def select_profiles(request: Request, uql=Depends(context_server_via_uql)):
#     try:
#         q = await request.body()
#         q = q.decode('utf-8')
#         if q:
#             q = f"SELECT PROFILE WHERE {q}"
#         else:
#             q = "SELECT PROFILE"
#         response_tuple = uql.select(q)
#         result = uql.respond(response_tuple)
#         result = list(filter_profile(result))
#         return result
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))
#
#
# @application.get("/profile/{id}")
# async def get_profile(id: str, uql=Depends(context_server_via_uql)):
#     q = f"SELECT PROFILE WHERE id=\"{id}\""
#
#     try:
#         response_tuple = uql.select(q)
#         result = uql.respond(response_tuple)
#         print(result)
#         return result["list"][0]
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))


# @application.get("/event/{id}")
# async def get_event(id: str, uql=Depends(context_server_via_uql)):
#     q = f"SELECT EVENT WHERE id=\"{id}\""
#
#     try:
#         response_tuple = uql.select(q)
#         result = uql.respond(response_tuple)
#         print(result)
#         return result["list"][0]
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))


# @application.get("/rule/{id}")
# async def get_rule(id: str, uql=Depends(context_server_via_uql)):
#     q = f"SELECT RULE WHERE id=\"{id}\""
#
#     try:
#         response_tuple = uql.select(q)
#         result = uql.respond(response_tuple)
#         print(result)
#
#         try:
#             elastic_result = elastic.get(config.elastic['index']['rules'], id)
#         except elasticsearch.exceptions.NotFoundError as e:
#             elastic_result = RecordNotFound()
#             elastic_result.message = "UQL Segment not found."
#
#         result = {
#             'meta': result['list'][0],
#         }
#
#         result['meta']['synchronized'] = True if not isinstance(elastic_result, RecordNotFound) else False
#
#         if not isinstance(elastic_result, RecordNotFound):
#             result['doc'] = {
#                 "condition": elastic_result['_source']['doc']["condition"],
#                 "actions": elastic_result['_source']['doc']["actions"],
#                 "uql": elastic_result['_source']['doc']["uql"],
#             }
#         else:
#             result['meta']['error'] = elastic_result.message
#
#         return result
#
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))


# @application.get("/segment/{id}")
# async def get_segment(id: str, uql=Depends(context_server_via_uql), elastic=Depends(elastic_client)):
#     q = f"SELECT SEGMENT WHERE id=\"{id}\""
#
#     try:
#         response_tuple = uql.select(q)
#         result = uql.respond(response_tuple)
#         print(result)
#         # return result
#         try:
#             elastic_result = elastic.get(config.elastic['index']['segments'], id)
#         except elasticsearch.exceptions.NotFoundError as e:
#             elastic_result = RecordNotFound()
#             elastic_result.message = "UQL Segment not found."
#
#         result = {
#             'meta': result['list'][0],
#         }
#
#         result['meta']['synchronized'] = True if not isinstance(elastic_result, RecordNotFound) else False
#
#         if not isinstance(elastic_result, RecordNotFound):
#             result['doc'] = {
#                 "condition": elastic_result['_source']['doc']["condition"],
#                 "uql": elastic_result['_source']['doc']["uql"],
#             }
#         else:
#             result['meta']['error'] = elastic_result.message
#
#         return result
#
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))


# @application.post("/scope")
# def insert_scope(scope: Scope, elastic=Depends(elastic_client)):
#     scope_index = config.elastic['index']['scopes']
#     scope = {
#         '_id': scope.get_id(),
#         'name': scope.name,
#     }
#     return elastic.insert(scope_index, [scope])
#
#
# @application.get("/scope/{id}")
# def get_scope(id: str, elastic=Depends(elastic_client)):
#     scope_index = config.elastic['index']['scopes']
#     result = elastic.get(scope_index, id)
#     return {
#         "meta": {
#             "id": result['_source']['doc']["_id"],
#         },
#         "doc": {
#             "name": result['_source']['doc']["name"],
#         }
#     }
#
#
# @application.post("/select/scopes")
# async def datagrid_select_segment(request: Request, elastic=Depends(elastic_client)):
#     try:
#         q = await request.body()
#         q = q.decode('utf-8')
#         if q:
#             q = {
#                 "query": {
#                     "regexp": {
#                         "doc.name": {
#                             "value": q + ".*",
#                             "flags": "ALL",
#                             "max_determinized_states": 1000,
#                         }
#                     }
#                 }
#             }
#         else:
#             q = {
#                 "query": {
#                     "match_all": {}
#                 }
#             }
#
#         scope_index = config.elastic['index']['scopes']
#
#         result = elastic.scan(scope_index, q)
#
#         return list(filter_scope(result))
#
#     except NullResponseError as e:
#         raise HTTPException(status_code=e.response_status, detail=str(e))
#     except Exception as e:
#         raise HTTPException(status_code=500, detail=str(e))
